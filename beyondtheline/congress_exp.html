<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link href='//fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet'>
	<link href='//fonts.googleapis.com/css?family=Roboto+Mono:400,100,300,700' rel='stylesheet'>
	<link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400i,600,600i,700,700i" rel="stylesheet">
	<title>Pennsylvania Election Results</title>
	<style>
		h1 {/*font-family: "Crimson Text", serif;*/
	  		font-family: "Roboto Mono";
  			font-size: 90px;
  			text-align: justify-all;
  			margin-left: auto;
    		margin-right: auto;
  		}
		h2 {font-family: "Roboto Mono", sans-serif;
  			font-size: 36px;
  			font-weight:700;
  			text-align: justify-all;
  			margin-left: auto;
    		margin-right: auto;
  		}
  		h3 {font-family: "Roboto Mono", sans-serif;
  			font-size: 24px;
  			font-weight: 400;
  			text-align: center;
  			margin-left: auto;
    		margin-right: auto;
  		}

  		h4 {font-family: "Roboto Mono", sans-serif;
  			font-size: 20px;
  			font-weight: 300;
  			width: 600px;
  			text-align: justify;
	  		text-wrap: normal;
	  		margin-left: auto;
    		margin-right: auto;
    		margin-bottom: 0px;
    		/*line-height: 0.7;	*/		
  		}
  		body {
	  		font-family: "Roboto", Helvetica, sans-serif;
	  		overflow-wrap: normal;
	  		/*width: 1000px;*/
	  		text-align: justify;
	  		text-wrap: normal;
	  		margin-left: auto;
    		margin-right: auto;
	  	}
	  	p {
	  		font-family: "Crimson Text", Helvetica, sans-serif;
	  		overflow-wrap: normal;
	  		/*width: 600px;*/
	  		text-align: justify;
	  		text-wrap: normal;
	  		margin-left: auto;
    		margin-right: auto;
	  	}
		.axis text {
			font: 10px sans-serif;
		}
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
		.y.axis path {
			/*stroke-dasharray: 4, 4;*/
		}
		.zero.axis path {
			stroke-dasharray: 4, 4;
		}
		.grid line {
			/*stroke-dasharray: 4, 4;*/
			stroke: #cccccc;
			stroke-opacity: 0.7;
			shape-rendering: crispEdges;
		}
		.grid .tick {
		    stroke: #cccccc;
		    stroke-dasharray: 4, 4;
		    opacity: 0.85;
		    shape-rendering: crispEdges;
		}
		.grid path {
			stroke-width: 0;
		}
		.chart-label {
			font: 11px sans-serif;
			/*font: 12px sans-serif;*/
			fill: #000;
			text-anchor: end;
		}
		.chart-yaxis-label {
			font: 11px sans-serif;
			/*font: 12px sans-serif;*/
			fill: #000;
			text-anchor: end;
		}
		.legend-labels text {
			font: 10px sans-serif;
			/*font: 12px sans-serif;*/
			fill: #bbbbbb;
			text-anchor: middle;
		}
		.colorBar-label {
			font: 11px "Roboto Mono";
			/*font: 12px sans-serif;*/
			fill: #bbbbbb;
			text-anchor: middle;
		}
		.color-bar-brushed {
			/*opacity: 0.6;*/
		}
		.dots {
		  stroke: #cccccc;
		  stroke-opacity: 0.5;
		}
		.dots-non-brushed{

		}
		.click-overlay{
			fill: none;
			pointer-events: all;
		}
		.click-overlay-variable{
			fill: none;
		}
		.map-text{
			font: 14px Roboto Mono;
			font-weight: 400;
			fill: #cccccc;
			stroke: none;
			text-anchor: end;
		}
		.map-sel-text{
			font: 11px Roboto Mono;
			font-weight: 400;
			fill: #cccccc;
			stroke: none;
			text-anchor: end;
		}
		.reset-text{
			font: 14px Roboto Mono;
			font-weight: 400;
			fill: #bbbbbb;
			stroke: none;
			text-anchor: end;
		}
		.city{
			fill: none;
			stroke: black;
			vector-effect: non-scaling-stroke;
		}
		.town{
			fill: none;
			stroke: black;
			vector-effect: non-scaling-stroke;
		}
		.city-label{
			font: 9px Roboto Mono;
			font-weight: 400;
			fill: black;
			stroke: none;
		}
		.demoMapSelBtn-rect-noPress{
			fill: #bbbbbb;
			stroke: white;
			stroke-width: 1px;
		}
		.demoMapSelBtn-text-noPress{
			font: 10px "Roboto Mono";
			font-weight: 400;
			fill: white;
			stroke: none;
			text-anchor: middle;
			dominant-baseline: central;
		}
		.demoMapSelBtn-rect-press {
			fill: white;
			stroke: #bbbbbb;
			stroke-width: 1px;
		}
		.demoMapSelBtn-text-press {
			font: 10px "Roboto Mono";
			font-weight: 400;
			fill: #bbbbbb;
			stroke: none;
			text-anchor: middle;
			dominant-baseline: central;
		}
		.voteMapSelBtn-rect-noPress{
			fill: #bbbbbb;
			stroke: white;
			stroke-width: 1px;
		}
		.voteMapSelBtn-text-noPress{
			font: 10px "Roboto Mono";
			font-weight: 400;
			fill: white;
			stroke: none;
			text-anchor: middle;
			dominant-baseline: central;
		}
		.voteMapSelBtn-rect-press {
			fill: white;
			stroke: #bbbbbb;
			stroke-width: 1px;
		}
		.voteMapSelBtn-text-press {
			font: 10px "Roboto Mono";
			font-weight: 400;
			fill: #bbbbbb;
			stroke: none;
			text-anchor: middle;
			dominant-baseline: central;
		}
		.selBtn-rect-hover{
			fill: #cccccc;
/*			stroke: white;
			stroke-width: 1px;*/
		}
		.selBtn-text-hover{
			fill: white;
		}
		.demoBars-title {
			font: 18px "Roboto Mono";
			font-weight: 300;
			fill: #aaaaaa;
			stroke: none;
			text-anchor: middle;
		}
		.voteMap-title {
			font: 18px "Roboto Mono";
			font-weight: 300;
			fill: #aaaaaa;
			stroke: none;
			text-anchor: middle;
		}
		.vote-tracts {
      		stroke-linejoin: round;
      		vector-effect: non-scaling-stroke;
		}
		.tracts-brushed {
			/*stroke: blue;
	  		stroke-width: 2px;*/
	  		/*opacity: .5;*/
/*	  		stroke-dasharray: 2, 2;*/
	  		stroke-linejoin: round;
		}
		.hover {
			stroke: "#ffffff";
		}
		.text-container {
		    /*background: rgb( 240, 240, 240);*/
		    width: 600px;
		    text-align: justify;
	  		text-wrap: normal;
	  		margin-left: auto;
    		margin-right: auto;
		}

		.leftColumn {
		    width: 50%;
		    /*height: 50px;*/
		    float: left;
		    display: inline-block;
		    /*background: rgb(200, 200, 245);*/
		}

		.rightColumn {
		    display: inline-block;
		    float: left;
		    width: 50%;
		    margin-left: 30px;
		    /*background: rgb( 200, 244, 244);*/
		}

	</style>
	  <script src="https://d3js.org/d3.v4.min.js"></script>
      <script src="https://d3js.org/d3-array.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo.v1.min.js"></script>
      <script src="https://d3js.org/d3-queue.v3.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>
      <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js" charset="utf-8"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.24.0/d3-legend.js"></script>

</head>
<body>
	<h2 style=text-align:center>Beyond the County Line</h2>
	<h3 style=text-align:center>New Scales of Understanding Election and Demographic Data</h3>
<!-- 	<h4>Case Study: Pennsylvania</h4> -->
	<div class="text-container">
	</div>
	</body>
	</html>
	<div id="cdmap" style=text-align:center></div>
	<div id="ctmap" style=text-align:center></div>
	<div id="cdselector" style=text-align:center></div>

	<!-- Page elements and content go here. -->
	<script>
		var rColor = "#f4003d",
			dColor = "#2437ff",
			dMapColor = "#394bff",
			oColor = "#f6b500",
			initialColor = "#cccccc" //light grey
			dkGrey = "#bbbbbb";

		
		//
		//
		//Make Selector Buttons and Dynamic Titles
		////////////////////////////////////////////////////

		//Set initial variables for visualizations
	  	var catSel = "DEMO"

	  	var voteMapDate = "2016",
			voteMapRace = "PRESIDENT";

		var demoVar = "PERCENT NON-WHITE";
			demoChange = "NO CHANGE";

		//Make container
		var selBoxWidth = 900,
			selBoxHeight = 300;

		var selContainer = d3.select("#cdselector")
			.append("svg")
			.attr("width", selBoxWidth)
			.attr("height", selBoxHeight);

		var voteLegendY = 15,
			voteTitleY = 80,
			voteSelectorY = 120,
			demoSelectorY = 165,
			demoTitleY = 245,
			demoLegendY = 265;
			

		var demoSelBoxWidth = 900,
			demoSelBoxHeight = 110;

		//Make legend
		var voteLegendBoxWidth = selBoxWidth,
			voteLegendBoxHeight = 38,
			voteLegendBarWidth = 530,
			voteLegendBarHeight = 9,
			voteLabelsNum = 5;

		// var voteLegendBox = selContainer.append("svg")
		// 	.attr("width", voteLegendBoxWidth)
		// 	.attr("height", voteLegendBoxHeight)
		// 	.attr("y", voteLegendY);

		// var voteLegend = voteLegendBox.append("g")
		// 	.attr("class", "vote-legend")
		// 	.each(makeVoteLegend);

		// var demoLegendBox = selContainer.append("svg")
		// 	.attr("width", voteLegendBoxWidth)
		// 	.attr("height", voteLegendBoxHeight)
		// 	.attr("y", demoLegendY);
			
		// var demoLegend = demoLegendBox.append("g")
		// 	.attr("class", "demo-legend")
		// 	.each(makeVoteLegend);


				
		
		//Set dimension variables
		var voteDateLabels = ["2016", "2012", "CHANGE"],
			voteRaceLabels = ["PRESIDENT", "US SENATE", "US CONGRESS"];

		var demoVarLabels = ["POPULATION DENSITY", "PERCENT NON-WHITE", "UNEMPLOYMENT RATE", "EDUCATION", "INCOME"],
			demoChangeLabels = ["CHANGE 2010-2015"];

		var voteDateBoxWidth = 250,
			voteDateBoxHeight =18,
			voteRaceBoxWidth = 250,
			voteRaceBoxHeight = 18,
			voteSelSpacing = 15;

		var voteDateButtonWidth = voteDateBoxWidth/(voteDateLabels.length),
			voteDateButtonHeight = voteDateBoxHeight,
			voteRaceButtonWidth = voteRaceBoxWidth/(voteRaceLabels.length),
			voteRaceButtonHeight = voteRaceBoxHeight;

		var demoButtonWidth = voteDateButtonWidth,
			demoButtonHeight = 30;

		var demoVarBoxWidth = demoButtonWidth*demoVarLabels.length,
			demoVarBoxHeight = demoButtonHeight,
			demoChangeBoxWidth = demoButtonWidth*demoChangeLabels.length,
			demoChangeBoxHeight = demoButtonHeight
			demoSelSpacing = 15;


		var voteDateContainer = selContainer.append("svg")
			.attr("class", "voteMapBtn-container")
			.attr("width", voteDateBoxWidth)
			.attr("height", voteDateBoxHeight)
			.attr("x", ((selBoxWidth/2)-(voteDateBoxWidth)-voteSelSpacing))
			.attr("y", voteSelectorY);

		var voteRaceContainer = selContainer.append("svg")
			.attr("class", "voteMapBtn-container")
			.attr("width", voteRaceBoxWidth)
			.attr("height", voteRaceBoxHeight)
			.attr("x", ((selBoxWidth/2)+voteSelSpacing))
			.attr("y", voteSelectorY);

		var demoVarContainer = selContainer.append("svg")
			.attr("class", "demoMapBtn-container")
			.attr("width", demoVarBoxWidth)
			.attr("height", demoVarBoxHeight)
			.attr("x", ((selBoxWidth/2)-voteDateBoxWidth-voteSelSpacing))
			.attr("y", demoSelectorY);

		var demoChangeContainer = selContainer.append("svg")
			.attr("class", "demoMapBtn-container")
			.attr("width", demoChangeBoxWidth)
			.attr("height", demoChangeBoxHeight)
			.attr("x", ((selBoxWidth/2)-voteDateBoxWidth+demoSelSpacing+(demoButtonWidth*demoVarLabels.length)))
			.attr("y", demoSelectorY);

		var voteMapTitle = selContainer.append("text")
			.attr("class", "voteMap-title")
			.attr("x", selBoxWidth/2)
			.attr("y", voteTitleY);

		var demoMapTitle = selContainer.append("text")
			.attr("class", "demoMap-title")
			.attr("x", selBoxWidth/2)
			.attr("y", demoTitleY)

		var voteDateButtons = voteDateContainer.selectAll("g")
			.data(voteDateLabels)
			.enter()
			.append("g")
			.attr("class", "date-buttons");

		var voteRaceButtons = voteRaceContainer.selectAll("g")
			.data(voteRaceLabels)
			.enter()
			.append("g")
			.attr("class", "race-buttons");

		var demoVarButtons = demoVarContainer.selectAll("g")
			.data(demoVarLabels)
			.enter()
			.append("g")
			.attr("class", "demoVar-buttons");

		var demoChangeButtons = demoChangeContainer.selectAll("g")
			.data(demoChangeLabels)
			.enter()
			.append("g")
			.attr("class", "demoChange-buttons");

		//make colored rectangle of date buttons
		voteDateButtons.append("rect")
			.attr("class", function(d) {
				if (catSel == "VOTE" && voteMapDate == d) {return "voteMapSelBtn-rect-date voteMapSelBtn-rect-press selBtn-rect-press";}
				else {return "voteMapSelBtn-rect-date voteMapSelBtn-rect-noPress selBtn-rect-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("width", voteDateButtonWidth)
			.attr("height", voteDateButtonHeight)
			.attr("x", function(d,i) {return voteDateButtonWidth*i;})
			.attr("y", 0)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleVoteButtonClick);

		//make colored rectangle of race buttons
		voteRaceButtons.append("rect")
			.attr("class", function(d) {
				if (catSel == "VOTE" && voteMapRace == d) {return "voteMapSelBtn-rect-race voteMapSelBtn-rect-press selBtn-rect-press";}
				else {return "voteMapSelBtn-rect-race voteMapSelBtn-rect-noPress selBtn-rect-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("width", voteRaceButtonWidth)
			.attr("height", voteRaceButtonHeight)
			.attr("x", function(d,i) {return voteRaceButtonWidth*i;})
			.attr("y", 0)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleVoteButtonClick);

		//make colored rectangle of demo variable buttons
		demoVarButtons.append("rect")
			.attr("class", function(d) {
				if (catSel == "DEMO" && demoVar == d) {return "demoMapSelBtn-rect-vars demoMApSelBtn-rect-press selBtn-rect-press";}
				else {return "demoMapSelBtn-rect-vars demoMapSelBtn-rect-noPress selBtn-rect-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("width", demoButtonWidth)
			.attr("height", demoButtonHeight)
			.attr("x", function(d,i) {return demoButtonWidth*i;})
			.attr("y", 0)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleDemoButtonClick);

		//make colored rectangle of demo change button
		demoChangeButtons.append("rect")
			.attr("class", function(d) {
				if (catSel == "DEMO" && demoChange == "CHANGE") {return "demoMapSelBtn-rect-change demoMapSelBtn-rect-press selBtn-rect-press";}
				else {return "demoMapSelBtn-rect-change demoMapSelBtn-rect-noPress selBtn-rect-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("width", demoButtonWidth)
			.attr("height", demoButtonHeight)
			.attr("x", function(d,i) {return demoButtonWidth*i;})
			.attr("y", 0)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleDemoButtonClick);


		//make text of date buttons
		voteDateButtons.append("text")
			.attr("class", function(d) {
				if (catSel == "VOTE" && voteMapDate == d) {return "voteMapSelBtn-text-date voteMapSelBtn-text-press selBtn-text-press";}
				else {return "voteMapSelBtn-text-date voteMapSelBtn-text-noPress selBtn-text-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("x", function(d,i) {return ((voteDateButtonWidth*i) + (voteDateButtonWidth/2));
			})
			.attr("y", voteDateButtonHeight/2)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleVoteButtonClick)
            .text(function(d) {return d;});

        //make text of race buttons
        voteRaceButtons.append("text")
			.attr("class", function(d) {
				if (catSel == "VOTE" && voteMapRace == d) {return "voteMapSelBtn-text-race voteMapSelBtn-text-press selBtn-text-press";}
				else {return "voteMapSelBtn-text-race voteMapSelBtn-text-noPress selBtn-text-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("x", function(d,i) {return ((voteRaceButtonWidth*i) + (voteRaceButtonWidth/2));
			})
			.attr("y", voteRaceButtonHeight/2)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleVoteButtonClick)
            .text(function(d) {return d;});

        //make text of demo variable buttons
        demoVarButtons.append("text")
			.attr("class", function(d) {
				if (catSel == "DEMO" && demoVar == d) {return "demoMapSelBtn-text-vars demoMapSelBtn-text-press selBtn-text-press";}
				else {return "demoMapSelBtn-text-vars demoMapSelBtn-text-noPress selBtn-text-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("x", function(d,i) {return ((demoButtonWidth*i) + (demoButtonWidth/2));
			})
			.attr("y", demoButtonHeight/2)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleDemoButtonClick)
            .text(function(d) {return d;})
            .call(wrap, demoButtonWidth-6);


        //make text of demo change button
        demoChangeButtons.append("text")
			.attr("class", function(d) {
				if (catSel == "DEMO" && demoChange == "CHANGE") {return "demoMapSelBtn-text-change demoMapSelBtn-text-press selBtn-text-press";}
				else {return "demoMapSelBtn-text-change demoMapSelBtn-text-noPress selBtn-text-noPress";}
			})
			.attr("buttonVal", function(d) {return d;})
			.attr("x", function(d,i) {return ((demoButtonWidth*i) + (demoButtonWidth/2));
			})
			.attr("y", demoButtonHeight/2)
			.on("mouseover", handleSelButtonMouseover)
			.on("mouseout", handleSelButtonMouseout)
			.on("click", handleDemoButtonClick)
            .text(function(d) {return d;})
            .call(wrap, demoButtonWidth-6);

        //box outlines
		voteDateContainer.append("rect")
        	.attr("width", voteDateBoxWidth)
        	.attr("height", voteDateBoxHeight)
        	.style("fill", "none")
        	.style("stroke", dkGrey)
        	.style("stroke-width", "2px");

        voteRaceContainer.append("rect")
        	.attr("width", voteDateBoxWidth)
        	.attr("height", voteDateBoxHeight)
        	.style("fill", "none")
        	.style("stroke", dkGrey)
        	.style("stroke-width", "2px");

        demoVarContainer.append("rect")
        	.attr("width", demoVarBoxWidth)
        	.attr("height", demoVarBoxHeight)
        	.style("fill", "none")
        	.style("stroke", dkGrey)
        	.style("stroke-width", "2px");

        demoChangeContainer.append("rect")
        	.attr("width", demoChangeBoxWidth)
        	.attr("height", demoChangeBoxHeight)
        	.style("fill", "none")
        	.style("stroke", dkGrey)
        	.style("stroke-width", "2px");

        // //style dynamic title of map
        // voteMapTitle
        // 	.text(getVoteMapTitle(voteMapDate, voteMapRace));

        // //style dynamic title of demoBars
        // demoBarsTitle
        // 	.text(getDemoBarsTitle(demoVar, demoChange));

	    // Queue up datasets using d3 Queue

		var boundary = "CD",
			boundName = "CD114FP",
			geoName = "PA_CDs";

		d3.queue()
          	.defer(d3.json, "jsons/PA_CDs_2015.json") 
		    .defer(d3.tsv, "data/CD_AllData.tsv")
		    .defer(d3.json, "data/PA_Cities.json")
		    .defer(boundary)
		    .defer(boundName)
		    .defer(geoName)
		    .await(makeMap); 


		function makeMap(error, pa, data, cities, boundary, boundName, geoName) {
			if (error) throw error;

	        //
			//
			//PROCESS AND FORMAT VOTE DATA
			///////////////////////////////////////////////////
			
			//CD DATA
			var usp2016MarginByBound = {},
		  		usp2012MarginByBound = {},
		  		uspChangeMarginByBound = {},
		  		uss2016MarginByBound = {},
		  		uss2012MarginByBound = {},
		  		ussChangeMarginByBound = {},
		  		usc2016MarginByBound = {},
		  		usc2012MarginByBound = {},
		  		uscChangeMarginByBound = {};

		  	//US PRESIDENT data
		  	data.forEach(function(d) {
		  		var dem16 = +d.USP_DEM_2016,
		  			rep16 = +d.USP_REP_2016,
		  			oth16 = +d.USP_OTH_2016,
		  			dem12 = +d.USP_DEM_2012,
		  			rep12 = +d.USP_REP_2012,
		  			oth12 = +d.USP_OTH_2012;


		  		var tot16 = dem16 + rep16 + oth16,
		  			tot12 = dem12 + rep12 + oth12;

		  		var margin16 = (rep16 - dem16)/tot16,
		  			margin12 = (rep12 - dem12)/tot12,
		  			change = margin16 - margin12;

		  		usp2016MarginByBound[d[boundary]] = margin16,
		  		usp2012MarginByBound[d[boundary]] = margin12,
		  		uspChangeMarginByBound[d[boundary]] = change;
		  	});

		  	//US SENATE data
		  	data.forEach(function(d) {
		  		var dem16 = +d.USS_DEM_2016,
		  			rep16 = +d.USS_REP_2016,
		  			oth16 = +d.USS_OTH_2016,
		  			dem12 = +d.USS_DEM_2012,
		  			rep12 = +d.USS_REP_2012,
		  			oth12 = +d.USS_OTH_2012;

		  		var tot16 = dem16 + rep16 + oth16,
		  			tot12 = dem12 + rep12 + oth12;

		  		var margin16 = (rep16 - dem16)/tot16,
		  			margin12 = (rep12 - dem12)/tot12,
		  			change = margin16 - margin12;

		  		uss2016MarginByBound[d[boundary]] = margin16,
		  		uss2012MarginByBound[d[boundary]] = margin12,
		  		ussChangeMarginByBound[d[boundary]] = change;
		  	});

		  	//US CONGRESS DATA
		  	data.forEach(function(d) {
		  		var dem16 = +d.USC_DEM_2016,
		  			rep16 = +d.USC_REP_2016,
		  			oth16 = +d.USC_OTH_2016,
		  			dem12 = +d.USC_DEM_2012,
		  			rep12 = +d.USC_REP_2012,
		  			oth12 = +d.USC_OTH_2012;

		  		var tot16 = dem16 + rep16 + oth16,
		  			tot12 = dem12 + rep12 + oth12;

		  		var margin16 = (rep16 - dem16)/tot16,
		  			margin12 = (rep12 - dem12)/tot12,
		  			change = margin16 - margin12;

		  		if (tot16 != 0) {
		  			usc2016MarginByBound[d[boundary]] = margin16;	
		  		}

		  		if (tot12 != 0) {
		  			usc2012MarginByBound[d[boundary]] = margin12;
		  		}

		  		if (tot16 != 0 && tot12 != 0) {
		  			uscChangeMarginByBound[d[boundary]] = change;
		  		}

		  		else {
			  		usc2016MarginByBound[d[boundary]] = "ERROR";
			  		usc2012MarginByBound[d[boundary]] = "ERROR";
			  		uscChangeMarginByBound[d[boundary]] = "ERROR";
			  	}
		  	});


		  	


		  	//
			//
			//PROCESS AND FORMAT DEMOGRAPHIC DATA
			///////////////////////////////////////////////////

			//CD DATA
			var popChangeByBound = {},
				popDenByBound = {},
		  		nonWhiteByBound = {},
		  		nonWhiteChangeByBound = {},
		  		unemployByBound = {},
		  		unemployChangeByBound = {},
		  		collegeByBound = {},
		  		collegeChangeByBound = {},
		  		incomeByBound = {},
		  		incomeChangeByBound = {};
		  	

		  	data.forEach(function(d) {
		  		var popChange = +d.TOTALPOP_CHANGE,
		  			popDen = +d.POPDEN_2015,
		  			nonWhite = +d.NONWHITE_2015,
		  			nonWhiteChange = +d.NONWHITE_CHANGE,
		  			unempl = +d.UNEMPLOY_2015,
		  			unemplChange = +d.UNEMPLOY_CHANGE,
		  			college = +d.COLLEGE_2015,
		  			collegeChange = +d.COLLEGE_CHANGE,
		  			income = +d.INC_2015,
		  			incomeChange = +d.INC_CHANGE;

		  		if (popChange == "error" || popChange == "null") {
		  			popChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {popChangeByBound[d[boundary]] = popChange;}

		  		if (popDen== "error" || popDen == "null") {
		  			popDenByBound[d[boundary]] = "ERROR";
		  		}
		  		else {popDenByBound[d[boundary]] = popDen;}

		  		if (nonWhite == "error" || nonWhite == "null") {
		  			popChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {nonWhiteByBound[d[boundary]] = nonWhite;}

		  		if (nonWhiteChange == "error" || nonWhiteChange == "null") {
		  			nonWhiteChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {nonWhiteChangeByBound[d[boundary]] = nonWhiteChange;}
		  		
		  		if (unempl == "error" || unempl == "null") {
		  			unemployByBound[d[boundary]] = "ERROR";
		  		}
		  		else {unemployByBound[d[boundary]] = unempl;}
		  		
		  		if (unemplChange == "error" || unemplChange == "null") {
		  			unemployChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {unemployChangeByBound[d[boundary]] = unemplChange;}

		  		if (college == "error" || college == "null") {
		  			collegeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {collegeByBound[d[boundary]] = college;}

		  		if (collegeChange == "error" || collegeChange == "null") {
		  			collegeChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {collegeChangeByBound[d[boundary]] = collegeChange;}

		  		if (income == "error" || income == "null") {
		  			incomeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {incomeByBound[d[boundary]] = income;}
	
				if (incomeChange == "error" || incomeChange == "null") {
		  			incomeChangeByBound[d[boundary]] = "ERROR";
		  		}
		  		else {incomeChangeByBound[d[boundary]] = incomeChange;}
		  	});
		  	
		  	var usp2016Margins = d3.values(usp2016MarginByBound),
		  		usp2012Margins = d3.values(usp2012MarginByBound),
		  		uspChangeMargins = d3.values(uspChangeMarginByBound),
		  		popChange = d3.values(popChangeByBound),
		  		popDen = d3.values(popDenByBound),
		  		nonWhite = d3.values(nonWhiteByBound),
		  		nonWhiteChange = d3.values(nonWhiteChangeByBound),
		  		unemploy = d3.values(unemployByBound),
		  		unemployChange = d3.values(unemployChangeByBound),
		  		college = d3.values(collegeByBound),
		  		collegeChange = d3.values(collegeChangeByBound),
		  		income = d3.values(incomeByBound),
		  		incomeChange = d3.values(incomeChangeByBound);


		  	

			//
			//
			//Make CD MAP
			///////////////////////////////////////////////////

			//Make container
			var mapBoxWidth = 650,
			    mapBoxHeight = 400;

			var mapContainer = d3.select("#ctmap")
				.append("svg")
			    .attr("width", mapBoxWidth)
			    .attr("height", mapBoxHeight)
			    .append("g");

			var mapG = cdMapContainer.append("g");

			//container for mouse events
			var mapZoomBox = mapContainer.append("rect")
				.attr("class", "click-overlay")
				.attr("width", mapBoxWidth)
				.attr("height", mmapBoxHeight)
				.on("mouseover", function() {
					mapZoomBox
						.style("stroke", initialColor)
			    		.style("stroke-width", "3px")
			    		.style("stroke-linecap", "butt")
			    		.style("stroke-dasharray", "2, 3");
				})
				.on("mouseout", function() {
					mapZoomBox
						.style("stroke", "none");
				})

			//Set projection information
		  	var mapProjection = d3.geoAlbers()
			    .rotate( [77.1945,0] )
	    		.center( [0, 41.2033] );
			    
	    	var mapPath = d3.geoPath()
			    .projection(mapProjection)
			    .pointRadius(function(d) {
		    		if (+d.properties.Population > 1000000) {return (5);}
		    		if (+d.properties.Population >100000) {return (3);}
		    		else {return (2);}
		    	});
		  	
		  	var allBounds = topojson.feature(pa, pa.objects[geoName]);


		  	mapProjection
		  		.scale(1)
		  		.translate([0,0]);

		  	var b = mapPath.bounds(allBounds),
			    s = .95 / Math.max((b[1][0] - b[0][0]) / mapBoxWidth, (b[1][1] - b[0][1]) / mapBoxHeight),
			    t = [(mapBoxWidth - s * (b[1][0] + b[0][0])) / 2, (mapBoxHeight - s * (b[1][1] + b[0][1])) / 2];

			mapProjection
		    	.scale(sCD)
		    	.translate(tCD);

		    var zoom = d3.zoom()
		    	.scaleExtent([1,10])
		    	.on("zoom", zoomed);

		    mapContainer
				.call(zoom);

	      	var seePlaces = "ON";

	      	//Make map geometry elements
		  	mapG.append("g")
			    .selectAll("path")
		    	.data(topojson.feature(paCDs, paCDs.objects[geoName]).features) 
		      	.enter().append("path")
		      	.attr("class", "bound-paths")
		      	.attr("cd", function(d) {return d.properties[boundName];})
		      	.attr("d", cdPath)
		      	.style("fill", function(d) { 
		      		var cd = d.properties[boundName];
				     		return getCDColor(cd); 
		      	})
		      	.style("stroke", "white")
		      	.style("stroke-width", "0.8px");
 
		    mapG.selectAll(".city")
		    	.data(topojson.feature(cities, cities.objects.PA_Cities).features)
		    	.enter().append("path")
		    	.attr("d", cdPath)
		    	.attr("class", "city")
		    	.attr("visibility", function(d) {
		    		if (seePlaces == "ON") {
		    			if (+d.properties.Population >= 28500) {return "visible";}
		    			else {return "hidden";}
		    		}
		    		if (seePlaces == "OFF") {return "hidden";}
		    		});


		    mapG.selectAll(".city-label")
		    	.data(topojson.feature(cities, cities.objects.PA_Cities).features)
		    	.enter().append("text")
		    	.attr("class", "city-label")
		    	.attr("transform", function(d) {return "translate(" + cdProjection(d.geometry.coordinates) + ")"; })
		    	.attr("visibility", function(d) {
		    		if (seePlaces == "ON") {
		    			if (+d.properties.Population >= 28500) {return "visible"}
		    			else {return "hidden";}
		    		}
		    		if (seePlaces == "OFF") {return "hidden";}
		    		})
		    	.attr("dy", function(d) {
		    		if (d.properties.City == "Bethlehem" || d.properties.City == "Philadelphia" || d.properties.City == "Pittsburgh") {return "-.35em";}
		    		// if (d.properties.City == "Wilkinsburg" || d.properties.City == "Monroesville" || d.properties.City == "Upper St. Clair") {return "1.3em";}
		    		else {return ".7em";}})
		    	.attr("x", function(d) { return d.geometry.coordinates[0] > -77.1945 ? -5 : 5; })
    			.style("text-anchor", function(d) { return d.geometry.coordinates[0] > -77.1945 ? "end" : "start"; })
    			.text(function(d) {return d.properties.City;});



		  //   var exploreText = voteMapContainer.append("text")
				// .attr("class", "map-text")
				// .attr("x", voteMapBoxWidth - 25)
				// .attr("y", 50)
				// .text("zoom and move map to explore"); 

			var placeNamesText = mapContainer.append("text")
				.attr("class", "map-sel-text")
				.attr("x", mapBoxWidth - 25)
				.attr("y", 25)
				.text(function() {
					if (seePlaces == "ON") {return "placenames: on";}
					if (seePlaces == "OFF") {return "placenames: off";}
				});

			var placeNamesBox = mapContainer.append("rect")
				.attr("class", "click-overlay")
				.attr("width", 120)
				.attr("height", 20)
				.attr("x", cdMapBoxWidth - 135)
				.attr("y", 10)
				.on("click", togglePlaceNames)
				.on("mouseover", function(d) {d3.select(this).style("cursor", "pointer");})
				.on("mouseout", function(d) {d3.select(this).style("cursor", "default");});

			var resetTextBox = mapContainer.append("rect")
				.attr("class", "click-overlay-variable")
				.attr("id", "resetClickOverlay")
				.attr("width", 120)
				.attr("height", 30)
				.attr("x", mapBoxWidth - 135)
				.attr("y", 35)
				.attr("pointer-events", "none")
				.on("click", resetZoom)
				.on("mouseover", function(d) {d3.select(this).style("cursor", "pointer");})
				.on("mouseout", function(d) {d3.select(this).style("cursor", "default");});

			
			function resetZoom() {
				mapContainer
					.transition()
					.duration(750)
						.call(zoom.transform, d3.zoomIdentity);
			}
					
			

	        	////////////////////////////////////////////////////
	       	//
	       	//FUNCTIONS WITHIN drawMap function
	       	////////////////////////////////////////////////////

	       	//
	       	//
	       	//MAP FUNCTIONS
	       	////////////////////////////////////////////////////	

	       	function zoomed() {
		    //Controls zoom behavior of map
		    //Turns on labels of smaller city when zoom level reaches 3
		    //Turns on bounding box for map when zoomed
		    //Scales placename labels on zoom
		    	mapG.attr("transform", d3.event.transform);

		    	var zoomScale = d3.zoomTransform(this).k;

		    	//controls scale and visibility of cities
		    	mapG.selectAll(".city")
		    		.attr("d", ctPath.pointRadius(function(d) {
		    		if (+d.properties.Population > 1000000) {return (5/zoomScale);}
		    		if (+d.properties.Population > 100000) {return (3/zoomScale);}
		    		else {return (2/zoomScale);}
		    		}))
		    		.attr("visibility", function(d) {
		    			if (seePlaces == "ON") {
		    				if (zoomScale >= 3) {return "visible";}
		    				if (zoomScale < 3) {
		    					if (+d.properties.Population >= 28500) {return "visible";}
		    					if (+d.properties.Population < 28500) {return "hidden";}
		    				}
		    			}
		    		if (seePlaces == "OFF") {return "hidden";}
		    		});

		    	//controls scale and visibility of city labels
		    	mapG.selectAll(".city-label")
		    		.style("font-size", function() {return 9/zoomScale + "px";})
		    		.attr("visibility", function(d) {
		    			if (seePlaces == "ON") {
		    				if (zoomScale >= 3) {return "visible";}
		    				if (zoomScale < 3) {
		    					if (+d.properties.Population >= 28500) {return "visible";}
		    					if (+d.properties.Population < 28500) {return "hidden";}
		    				}
		    			}
		    		if (seePlaces == "OFF") {return "hidden";}
		    		})
		    		.attr("dy", function(d) {
			    		if (d.properties.City == "Bethlehem" || d.properties.City == "Philadelphia" || d.properties.City == "Pittsburgh") {return -.35/zoomScale+"em";}
			    		if (d.properties.City == "Wilkinsburg" || d.properties.City == "Monroeville" || d.properties.City == "Upper St. Clair") {return 3/zoomScale+"em";}
			    		else {return .7/zoomScale+"em";}})
			    	.attr("x", function(d) { return d.geometry.coordinates[0] > -77.1945 ? -7/zoomScale : 7/zoomScale; })
	    			.style("text-anchor", function(d) { return d.geometry.coordinates[0] > -77.1945 ? "end" : "start"; });

	    		//
	    		// exploreText
	    		// 	.text(function() {
	    		// 		if (zoomScale >= 1.2) {
	    		// 			return "reset map";}
	    		// 		else {return "zoom and move map to explore";}
	    		// 	})
	    		// 	.style("fill", function() {
	    		// 		if (zoomScale >= 1.2) 
	    		// 			return "black";
	    		// 	});

	    		placeNamesText
	    			.style("fill", function() {
	    				if (zoomScale >= 1.2) 
	    					return "black";
	    			});

	    		resetTextBox
	    			.attr("pointer-events", function() {
	    				if (zoomScale >= 1.2) {
	    					return "all";
	    				}
	    				else {return "none";}
	    			});
	    			

	    		//turns on dashed map bounding box on zoom
	    		//makes reset button
		    	if (d3.zoomTransform(this).k != 1) {
			    	mapZoomBox
			    		.style("stroke", initialColor)
			    		.style("stroke-width", "3px")
			    		.style("stroke-linecap", "butt")
			    		.style("stroke-dasharray", "2, 3");
			    }


			    //turns off dashed map bounding box when zoom back out to 1
			    if (d3.zoomTransform(this).k == 1) {
			    	mapZoomBox
			    		.style("stroke", "none");
			    }
		    }


		    function togglePlaceNames () {
		    //controls visibility of placenames on map via user input

				if (seePlaces == "ON") {
					var newSeePlaces = "OFF";
					placeNamesText
						.text("placenames: off");
					mapG.selectAll(".city")
						.attr("visibility", "hidden");
					mapG.selectAll(".city-label")
						.attr("visibility", "hidden");
				}
				if (seePlaces == "OFF") {
					var newSeePlaces = "ON";
					placeNamesText
						.text("placenames: on");
					mapG.selectAll(".city")
						.attr("visibility", function(d) {
							if (+d.properties.Population >= 28500) {return "visible";}
							else {return "hidden";}	
						});
					mapG.selectAll(".city-label")
						.attr("visibility", function(d) {
							if (+d.properties.Population >= 28500) {return "visible";}
							else {return "hidden";}	
						});
				}
				seePlaces = newSeePlaces;
			}		

			//
	       	//
	       	//SELECTOR FUNCTIONS
	       	////////////////////////////////////////////////////

		    //SELECTOR FUNCTIONS
	       	//
	       	//Functions to register new selection
	       	////////////////////////////////////////////////////

		    



		    //SELECTOR FUNCTIONS
	       	//
	       	//Functions to update elements based on new selection
	       	////////////////////////////////////////////////////

		    function getVoteMapTitle(voteMapDate, voteMapRace) {
		    //updates map title according to selected date and race variables

        		if (voteMapDate == "CHANGE") {
        			var dateText = "Change in Margin, 2012 - 2016";
        		}
        		else {
        			var dateText = voteMapDate;
        		}

        		if (voteMapRace == "PRESIDENT") {
        			var mapText = "US Presidential";
        		}
        		if (voteMapRace == "US SENATE") {
					var mapText = "US Senate";
        		}
        		if (voteMapRace == "US CONGRESS") {
        			var mapText = "US Congressional";
        		}
        		return mapText + " Election: " + dateText;
		        		
		    }


		    function getDemoBarsTitle(demoVar, changeVar) {
		    //updates bar chart title according to selected demographic variables

    			if (demoVar == "PERCENT NON-WHITE") {
    				var demoVarText = "Non-White, Non-Hispanic Population";
    			}
    			if (demoVar == "UNEMPLOYMENT RATE") {
    				var demoVarText = "Unemployment Rate";
    			}
    			if (demoVar == "EDUCATION") {
    				var demoVarText = "Population with Bachelor's Degree";
    			}
    			if (demoVar == "INCOME") {
    				var demoVarText = "Median Income";
    			}
    			if (demoChange == "NO CHANGE") {
    				var demoChangeText = "",
    					demoDateText = "2015";

    				if (demoVar == "POPULATION DENSITY") {
    					var demoVarText = "Population Density";
    				}
    			}
    			if (demoChange == "CHANGE") {
    				var demoChangeText = "Change in ",
    					demoDateText = "2010-2015";

    				if (demoVar == "POPULATION DENSITY") {
    					var demoVarText = "Population";
    				}
    			}
    			return demoChangeText + demoVarText + " by Census Tract";
		    }
		 


		    function updateMap(d) {
		    //updates map colors according to selected date and race variables
				
				d3.selectAll(".bound-paths")
			      	.transition()
				     	.duration(400)	
				     	.style("fill", function(d) {
				     		var cd = d.properties[boundName];
				     		return getColor(cd); 
				     	});
				     	// .style("stroke", function(d) {
				     	// 	var cd = d.properties[boundName];
				     	// 	if 
				     	// }); 		
		    }


		    //SELECTOR FUNCTIONS
	       	//
	       	//General graphics functions (no data changes)
	       	////////////////////////////////////////////////////

	       	function makeVoteLegend() {

				var legend = d3.select(this)
					.attr("class", "legend");

				var legendPadding = {top: 12, bottom: 12};

				var defs = legend.append("defs");

				var voteColorGradient = defs.append("linearGradient")
	    			.attr("id", "voteColor-gradient")
	    			.attr("x1", "0%")
				    .attr("y1", "0%")
				    .attr("x2", "100%")
				    .attr("y2", "0%");

				voteColorGradient.selectAll("stop")
					.data([
						{offset: "0%", color: '#3c5bff'}, 
				        {offset: "50%", color: '#e6f0ff'}, 
				        {offset: "50%", color: '#f8e5e6'},        
				        {offset: "100%", color: '#dd0035'} 
						])
					.enter().append("stop")
					.attr("offset", function(d) { return d.offset; })   
	    			.attr("stop-color", function(d) { return d.color; });

	    		var voteLegendColorBar = legend.append("rect")
	    			.attr("width", voteLegendBarWidth)
	    			.attr("height", voteLegendBarHeight)
	    			.attr("x", (selBoxWidth/2)-(voteLegendBarWidth/2))
	    			.attr("y", legendPadding.top)
	    			.style("fill", "url(#voteColor-gradient)")

	    		var voteLegendAxis = legend.append("g")
	    			.attr("class", "legend")
	    			.attr("id", "legendAxis")
	    			.attr("transform", "translate(" + ((selBoxWidth/2)-(voteLegendBarWidth/2)) + "," + (voteLegendBarHeight+legendPadding.top) + ")")
	    			.each(makeLegendLabels);
			
			}


			function makeLegendLabels() {

    			var legendLabels = d3.select(this)
    				.attr("class", "legend-labels");

    			var labels = getLabels(voteMapDate, voteLabelsNum);

				labels.forEach(function(label, index) {

					legendLabels.append("text")
						.attr("class", "legend-labels legend-label-vals")
						.attr("x", index*voteLegendBarWidth/((voteLabelsNum*2)))
						.attr("y", voteLegendBarHeight + 3)
						.text(d3.format(".0%")(label));
				});

				var marginLabel = legendLabels.append("text")
					.attr("class", "legend-labels-title legend-labels")
					.attr("x", voteLegendBarWidth/2)
					.attr("y", -14)
					.text(function() {
						if (voteMapDate != "CHANGE") {return "vote margin";}
	    				if (voteMapDate == "CHANGE") {return "change in margin";}
					});

				var demLabel = legendLabels.append("text")
					.attr("class", "legend-labels")
					.attr("x", -5)
					.attr("y", -4)
					.text("Democrat")
					.style("text-anchor", "end")
					.style("dominant-baseline", "middle");

				var repLabel = legendLabels.append("text")
					.attr("class", "legend-labels")
					.attr("x", voteLegendBarWidth+5)
					.attr("y", -4)
					// .attr("y", voteLegendBarHeight + 3)
					.text("Republican")
					.style("text-anchor", "start")
					.style("dominant-baseline", "middle");
				
				}


			function getLabels(voteMapDate, voteLabelsNum){
	    				
    				if (voteMapDate == "CHANGE") {var labelMax = 0.5;}
	    			if (voteMapDate != "CHANGE") {var labelMax = 1;}

		    		var labelsRight = Array.from(new Array(voteLabelsNum + 1),(val,index)=>index*labelMax/voteLabelsNum);

		    		var labelsLeft = Array.from(new Array(voteLabelsNum),(val,index)=>((voteLabelsNum-index)*labelMax)/voteLabelsNum);
		    			
		    		var labels = labelsLeft.concat(labelsRight);

		    		return labels;
	    	}


		    


		    //
	       	//
	       	//HELPER functions 
	       	////////////////////////////////////////////////////
		    
			// function getDemoData(d) {
			// //returns data for demographic selection

			// 	if (demoChange == "NO CHANGE") {
			// 		if (demoVar == "POPULATION DENSITY") {
			// 			return +d.POPDEN_2015;
			// 		}
			// 		if (demoVar == "PERCENT NON-WHITE") {
			// 			return +d["PERCNONWHITE_2015"];
			// 		}
			// 		if (demoVar == "UNEMPLOYMENT RATE") {
			// 			return +d.UNEMPLOYMENT_2015;
			// 		}
			// 		if (demoVar == "EDUCATION") {
			// 			return +d.COLLEGE_2015;
			// 		}
			// 		if (demoVar == "INCOME") {
			// 			return +d.MEDIANINC_2015;
			// 		}
			// 	}
			// 	if (demoChange == "CHANGE") {
			// 		if (demoVar == "POPULATION DENSITY") {
			// 			return +d.POPDEN_CHANGE;
			// 		}
			// 		if (demoVar == "PERCENT NON-WHITE") {
			// 			return +d.PERCNONWHITE_CHANGE;
			// 		}
			// 		if (demoVar == "UNEMPLOYMENT RATE") {
			// 			return +d.UNEMPLOYMENT_CHANGE;
			// 		}
			// 		if (demoVar == "EDUCATION") {
			// 			return +d.COLLEGE_CHANGE;
			// 		}
			// 		if (demoVar == "INCOME") {
			// 			return +d.MEDIANINC_CHANGE;
			// 		}
			// 	}
			// }


			function getDemoVarCD() {

				if (demoChange == "NO CHANGE") {
					if (demoVar == "POPULATION DENSITY") {
						return popDen;
					}
					if (demoVar == "PERCENT NON-WHITE") {
						return nonWhite;
					}
					if (demoVar == "UNEMPLOYMENT RATE") {
						return unemploy;
					}
					if (demoVar == "EDUCATION") {
						return college;
					}
					if (demoVar == "INCOME") {
						return income;
					}
				}
				if (demoChange == "CHANGE") {
					if (demoVar == "POPULATION DENSITY") {
						return popChange;
					}
					if (demoVar == "PERCENT NON-WHITE") {
						return nonWhiteChange;
					}
					if (demoVar == "UNEMPLOYMENT RATE") {
						return unemployChange;
					}
					if (demoVar == "EDUCATION") {
						return collegeChange;
					}
					if (demoVar == "INCOME") {
						return incomeChange;
					}
				}
			}


			// function getDemoVarName() {

			// 	if (demoChange == "NO CHANGE") {
			// 		if (demoVar == "POPULATION DENSITY") {
			// 			return "POPDEN_2015";
			// 		}
			// 		if (demoVar == "PERCENT NON-WHITE") {
			// 			return "PERCNONWHITE_2015";
			// 		}
			// 		if (demoVar == "UNEMPLOYMENT RATE") {
			// 			return "UNEMPLOYMENT_2015";
			// 		}
			// 		if (demoVar == "EDUCATION") {
			// 			return "COLLEGE_2015";
			// 		}
			// 		if (demoVar == "INCOME") {
			// 			return "MEDIANINC_2015";
			// 		}
			// 	}
			// 	if (demoChange == "CHANGE") {
			// 		if (demoVar == "POPULATION DENSITY") {
			// 			return "POPDEN_CHANGE";
			// 		}
			// 		if (demoVar == "PERCENT NON-WHITE") {
			// 			return "PERCNONWHITE_CHANGE";
			// 		}
			// 		if (demoVar == "UNEMPLOYMENT RATE") {
			// 			return "UNEMPLOYMENT_CHANGE";
			// 		}
			// 		if (demoVar == "EDUCATION") {
			// 			return "COLLEGE_CHANGE";
			// 		}
			// 		if (demoVar == "INCOME") {
			// 			return "MEDIANINC_CHANGE";
			// 		}
			// 	}
			// }


			function getColor(cd) {

				numColors = 18;

				var demoColor = d3.scaleLinear()
	    			.domain(getColorDomain(numColors))
	    			.range(getColorRange(numColors));

	    		//Set colors
			    var voteColorRed = d3.scaleLinear()
		      		.domain([0,1])
		      		.range(['#f8e5e6','#dd0035']);

		      	var voteColorBlue = d3.scaleLinear()
		      		.domain([-1,0])
		      		.range(['#3c5bff', '#e6f0ff']);

		      	var changeColorRed = d3.scaleLinear()
		      		.domain([0,.5])
		      		.range(['#f8e5e6','#dd0035']);

		      	var changeColorBlue = d3.scaleLinear()
		      		.domain([-0.5,0])
		      		.range(['#3c5bff', '#e6f0ff']);


      			if (catSel == "VOTE") {
	      			if (voteMapDate == "2016" && voteMapRace == "PRESIDENT") {
	      				if (isNaN(usp2016MarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (usp2016MarginByBound[boundary] >= 0) {
			      				return voteColorRed(usp2016MarginByBound[boundary]);
			      			} 
			      			if (usp2016MarginByBound[boundary] < 0) {
			      				return voteColorBlue(usp2016MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "2016" && voteMapRace == "US SENATE") {
	      				if (isNaN(uss2016MarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (uss2016MarginByBound[boundary] >= 0) {
			      				return voteColorRed(uss2016MarginByBound[boundary]);
			      			} 
			      			if (uss2016MarginByBound[boundary] < 0) {
			      				return voteColorBlue(uss2016MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "2016" && voteMapRace == "US CONGRESS") {
	      				if (isNaN(usc2016MarginByBound[boundary])) {return initialColor;}
		      			else {
		      				if (usc2016MarginByBound[boundary] >= 0) {
			      				return voteColorRed(usc2016MarginByBound[boundary]);
			      			} 
			      			if (usc2016MarginByBound[boundary] < 0) {
			      				return voteColorBlue(usc2016MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "2012" && voteMapRace == "PRESIDENT") {
	      				if (isNaN(usp2012MarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (usp2012MarginByBound[boundary] >= 0) {
			      				return voteColorRed(usp2012MarginByBound[boundary]);
			      			} 
			      			if (usp2012MarginByBound[boundary] < 0) {
			      				return voteColorBlue(usp2012MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "2012" && voteMapRace == "US SENATE") {
	      				if (isNaN(uss2012MarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (uss2012MarginByBound[boundary] >= 0) {
			      				return voteColorRed(uss2012MarginByBound[boundary]);
			      			} 
			      			if (uss2012MarginByBound[boundary] < 0) {
			      				return voteColorBlue(uss2012MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "2012" && voteMapRace == "US CONGRESS") {
	      				if (isNaN(usc2012MarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (usc2012MarginByBound[boundary] >= 0) {
			      				return voteColorRed(usc2012MarginByBound[boundary]);
			      			} 
			      			if (usc2012MarginByBound[boundary] < 0) {
			      				return voteColorBlue(usc2012MarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "CHANGE" && voteMapRace == "PRESIDENT") {
	      				if (isNaN(uspChangeMarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (uspChangeMarginByBound[boundary] >= 0) {
			      				return changeColorRed(uspChangeMarginByBound[boundary]);
			      			} 
			      			if (uspChangeMarginByBound[boundary] < 0) {
			      				return changeColorBlue(uspChangeMarginByBound[boundary]);
			      			}
			      		}
	      			}
	      			if (voteMapDate == "CHANGE" && voteMapRace == "US SENATE") {
	      				if (isNaN(ussChangeMarginByBound[boundary])) {return initialColor;}
	      				else {
		      				if (ussChangeMarginByBound[boundary] >= 0) {
			      				return changeColorRed(ussChangeMarginByBound[boundary]);
			      			} 
			      			if (ussChangeMarginByBound[boundary] < 0) {
			      				return changeColorBlue(ussChangeMarginByBound[boundary]);
			      			}
			      		}
	      			}	
	      			if (voteMapDate == "CHANGE" && voteMapRace == "US CONGRESS") {
	      				if (isNaN(uscChangeMarginByBound[boundary])) {return initialColor;}
		      			else {
		      				if (uscChangeMarginByBound[boundary] >= 0) {
			      				return changeColorRed(uscChangeMarginByBound[boundary]);
			      			} 
			      			if (uscChangeMarginByBound[boundary] < 0) {
			      				return changeColorBlue(uscChangeMarginByBound[boundary]);
			      			}
			      		}
		      		} 
			    }
			    if (catSel == "DEMO") {
			    	if (demoVar == "POPULATION DENSITY" && demoChange == "NO CHANGE") {
			    		if (isNaN(popDenByBound[boundary])) {return initialColor;}
			    		else {return demoColor(popDenByBound[boundary]);
			    		}
			    	}
			      	if (demoVar == "PERCENT NON-WHITE" && demoChange == "NO CHANGE") {
			      		if (isNaN(nonWhiteByBound[boundary])) {return initialColor;}
			    		else {return demoColor(nonWhiteByBound[boundary]);
			    		}
			      	} 		
			      	if (demoVar == "UNEMPLOYMENT RATE" && demoChange == "NO CHANGE") {
	      				if (isNaN(unemployByBound[boundary])) {return initialColor;}
			    		else {return demoColor(unemployByBound[boundary]);	
			    		}	
			      	}
			      	if (demoVar == "EDUCATION" && demoChange == "NO CHANGE") {
	      				if (isNaN(collegeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(collegeByBound[boundary]);
			    		}
			      	}
			      	if (demoVar == "INCOME" && demoChange == "NO CHANGE") {
	      				if (isNaN(incomeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(incomeByBound[boundary]);
			    		}
			      	}
	      			if (demoVar == "POPULATION DENSITY" && demoChange == "CHANGE") {
	      				if (isNaN(popChangeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(popChangeByBound[boundary]);
			    		}
			      	}
			      	if (demoVar == "PERCENT NON-WHITE" && demoChange == "CHANGE") {
		      			if (isNaN(nonWhiteChangeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(nonWhiteChangeByBound[boundary]);
			    		}
			      	}
			      	if (demoVar == "UNEMPLOYMENT RATE" && demoChange == "CHANGE") {
		      			if (isNaN(unemployChangeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(unemployChangeByBound[boundary]);
			    		}
			      	}
			      	if (demoVar == "EDUCATION" && demoChange == "CHANGE") {
		      			if (isNaN(collegeChangeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(collegeChangeByBound[boundary]);
			    		}
			      	}
			      	if (demoVar == "INCOME" && demoChange == "CHANGE") {
	      				if (isNaN(incomeChangeByBound[boundary])) {return initialColor;}
			    		else {return demoColor(incomeChangeByBound[boundary]);
			    		}
		      		}
			    }
		    }


		    function getColorDomain(numColors) {

		    	var numColorsRange = Array.from(new Array(numColors),(val,index)=>index+1);

		    	var selDemo = getDemoVar();
		    	// console.log(selDemo);

		    	var demoMax = d3.max(selDemo);
	    			demoMin = d3.min(selDemo);

	    		// console.log(demoMax);
	    		// console.log(demoMin);

		    	var selDemoPos = [],
		    		selDemoNeg = [];

		    	selDemo.forEach(function(value) {
		    		if (value >= 0) {
		    			selDemoPos.push(value);
		    		}
		    		if (value < 0) {
		    			selDemoNeg.push(value);
		    		}
		    	})

    			if (Math.abs(demoMax) >= Math.abs(demoMin)) {
    				if (demoMin >= 0) {
    					var diff = (demoMax-demoMin)/5;
    					return [demoMin, demoMin+diff, demoMin+(2*diff), demoMin+(3*diff), demoMin+(4*diff), demoMax];
    					
    				}
    				if (demoMin < 0) {
    					return [-demoMax, demoMax];
    				}
    			}
    			if (Math.abs(demoMax) < Math.abs(demoMin)) {
    				return [demoMin, -demoMin];
	    		}
    			
    			// if (Math.abs(demoMax) >= Math.abs(demoMin)) {
    			// 	var bins = d3.scaleQuantile()
    			// 		.domain(selDemoPos)
    			// 		.range(numColorsRange);
    			// 	var threshVals = bins.quantiles();
    			// 	if (demoMin >= 0) {
    			// 		threshVals.push(demoMax);
    			// 		// console.log(threshVals);
    			// 		return threshVals;
    			// 	}
    			// 	if (demoMin < 0) {
    			// 		var negThreshVals = threshVals.map(function(n){
    			// 			return (n*-1);
    			// 		});
    			// 		negThreshVals.reverse();
    			// 		negThreshVals.push(0);
    			// 		var orderedThreshVals = negThreshVals.concat(threshVals);
    			// 		orderedThreshVals.push(demoMax);
    			// 		return orderedThreshVals;
    			// 	}
    			// }
    			
    			// if (Math.abs(demoMax) < Math.abs(demoMin)) {
    			// 	var bins = d3.scaleQuantile()
    			// 		.domain(selDemoNeg)
    			// 		.range(numColorsRange);
    			// 	var threshVals = bins.quantiles();

    			// 	var negThreshVals = threshVals.map(function(n){
    			// 			return (n*-1);
    			// 		});
    			// 	negThreshVals.reverse();
    				
    			// 	threshVals.push(0);
    			// 	var orderedThreshVals = threshVals.concat(negThreshVals);
    			// 	orderedThreshVals.push(-demoMin);
    			// 	return orderedThreshVals;
	    		// }
	    	}



	    	function getColorRange(numColors) {

	    		var YGBgrad1 = ["#eff68f", "#9ce673", "#5ccc94", "#46ad9d", "#318f98", "#1c7293"],
	    			YGBgrad2 = ["#eff4b3", "#aae28f", "#71c99b", "#54ab9d", "#388f97", "#1c7293"],
	    			YORgrad1 = ["#eff4b3", "#f2de9d", "#f0c798", "#f1af8f", "#f4938e", "#fa709a"],
	    			YOPgrad1 = ["#eff4b3", "#e4bc84", "#e37a65", "#bf3c7d", "#7b2077", "#330867"],
	    			YOPgrad2 = ["#fff0a7", "#ffc697", "#ff9897", "#ff58b4", "#de00d9", "#8d00f8"],
	    			YOPgrad3 = ["#fff0a7", "#ffc96c", "#ff9d4a", "#ff674f", "#f40073", "#bd0082"],
	    			BPRgrad1 = ["#c7eafd", "#b8d0fc", "#c1aefb", "#e479fa", "#fa35d2", "#e8198b"];

	    		var numColorsRange = Array.from(new Array(numColors),(val,index)=>((index+1)/numColors));

	    		var selDemo = getDemoVar();
		    	
		    	var demoMax = d3.max(selDemo);
	    			demoMin = d3.min(selDemo);

		    	var selDemoPos = [],
		    		selDemoNeg = [];

		    	selDemo.forEach(function(value) {
		    		if (value >= 0) {
		    			selDemoPos.push(value);
		    		}
		    		if (value < 0) {
		    			selDemoNeg.push(value);
		    		}
		    	})

	    		if (demoMin >= 0) {
    				return BPRgrad1;
    			}
    			if (demoMin < 0) {
    				posColorVals = [];
    				negColorVals = [];
    				
    				numColorsRange.forEach(function(value, i){
    					var posColorVal = d3.interpolatePuRd(value),
    						negColorVal = d3.interpolateBlues(value);
    					posColorVals.push(posColorVal);
    					negColorVals.push(negColorVal);
    				})
    				var invNegColorVals = negColorVals;
    				invNegColorVals.reverse();

	    			var	orderedColorVals = invNegColorVals.concat(posColorVals);
    				return orderedColorVals;
    			}

    			// if (demoMin >= 0) {
	    		// 	colorVals = [];
    			// 	numColorsRange.forEach(function(value, i){
    			// 		var colorVal = d3.interpolateYlOrRd(value)
    			// 		colorVals.push(colorVal);
    			// 	})
    			// 	// console.log(colorVals);
    			// 	return colorVals;
    			// }
    			// if (demoMin < 0) {
    			// 	posColorVals = [];
    			// 	negColorVals = [];
    				
    			// 	numColorsRange.forEach(function(value, i){
    			// 		var posColorVal = d3.interpolateYlOrRd(value),
    			// 			negColorVal = d3.interpolateYlGnBu(value);
    			// 		posColorVals.push(posColorVal);
    			// 		negColorVals.push(negColorVal);
    			// 	})
    			// 	var invNegColorVals = negColorVals;
    			// 	invNegColorVals.reverse();

	    		// 	var	orderedColorVals = invNegColorVals.concat(posColorVals);
    			// 	return orderedColorVals;
    			// }	
	    	}


	    	

	    	

			
		}

		function handleSelButtonMouseover(d) {
		    //changes color of button background on mouseover

		    	d3.select(this).style("cursor", "pointer");

		    	d3.selectAll(".voteMapSelBtn-rect-date").filter(function() {return this.getAttribute("buttonVal") == d;}).filter(".voteMapSelBtn-rect-noPress")
		    		.classed("selBtn-rect-hover", true);

		    	d3.selectAll(".voteMapSelBtn-rect-race").filter(function() {return this.getAttribute("buttonVal") == d;}).filter(".voteMapSelBtn-rect-noPress")
		    		.classed("selBtn-rect-hover", true);

		    	d3.selectAll(".demoMapSelBtn-rect-vars").filter(function() {return this.getAttribute("buttonVal") == d;}).filter(".demoMapSelBtn-rect-noPress")
		    		.classed("selBtn-rect-hover", true);

		    	d3.selectAll(".demoMapSelBtn-rect-change").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-rect-hover", true);

		    	d3.selectAll(".demoMapSelBtn-text-change").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-text-hover", true);
		    }


		    function handleSelButtonMouseout(d) {
		    //restores original color of button background on mouseout	

		    	d3.select(this).style("cursor", "default");

		    	d3.selectAll(".voteMapSelBtn-rect-date").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-rect-hover", false);

		    	d3.selectAll(".voteMapSelBtn-rect-race").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-rect-hover", false);

		    	d3.selectAll(".demoMapSelBtn-rect-vars").filter(function() {return this.getAttribute("buttonVal") == d;}).filter(".demoMapSelBtn-rect-noPress")
		    		.classed("selBtn-rect-hover", false);

		    	d3.selectAll(".demoMapSelBtn-rect-change").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-rect-hover", false);

		    	d3.selectAll(".demoMapSelBtn-text-change").filter(function() {return this.getAttribute("buttonVal") == d;})
		    		.classed("selBtn-text-hover", false);

		    }


		    function handleVoteButtonClick(d) {
		    //updates global variable to newly chosen var via mouse click
		    //reclasses buttons when one is clicked
		    //reclassing changes graphic attributes to show new button as "selected" and others as "unselected"
		    	// console.log(catSel)
		    	// console.log(voteMapDate)
		    	// console.log(voteMapRace)
		    	// console.log(demoVar)
		    	// console.log(demoChange)
		    	catSel = "VOTE"

		    	if (d == "2016" || d == "2012" || d == "CHANGE") {
		    		voteMapDate = d;
		    	}

		    	if (d == "PRESIDENT" || d ==  "US SENATE" || d == "US CONGRESS") {
		    		voteMapRace = d;
		    	}
		    	// console.log(catSel)
		    	// console.log(voteMapDate)
		    	// console.log(voteMapRace)

		    	//change classes for selected vote map button
		    	d3.selectAll(".voteMapSelBtn-rect-date").filter(function() {return this.getAttribute("buttonVal") == voteMapDate;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", true)
		    		.classed("voteMapSelBtn-rect-noPress", false);

		    	d3.selectAll(".voteMapSelBtn-text-date").filter(function() {return this.getAttribute("buttonVal") == voteMapDate;})
		    		.classed("voteMapSelBtn-text-press", true)
		    		.classed("voteMapSelBtn-text-noPress", false);

		    	//change classes for other vote date buttons
		    	d3.selectAll(".voteMapSelBtn-rect-date").filter(function() {return this.getAttribute("buttonVal") != voteMapDate;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", false)
		    		.classed("voteMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".voteMapSelBtn-text-date").filter(function() {return this.getAttribute("buttonVal") != voteMapDate;})
		    		.classed("voteMapSelBtn-text-press", false)
		    		.classed("voteMapSelBtn-text-noPress", true);

		    	//change classes for selected vote race button
		    	d3.selectAll(".voteMapSelBtn-rect-race").filter(function() {return this.getAttribute("buttonVal") == voteMapRace;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", true)
		    		.classed("voteMapSelBtn-rect-noPress", false);

		    	d3.selectAll(".voteMapSelBtn-text-race").filter(function() {return this.getAttribute("buttonVal") == voteMapRace;})
		    		.classed("voteMapSelBtn-text-press", true)
		    		.classed("voteMapSelBtn-text-noPress", false);

		    	//change classes for other vote race buttons
		    	d3.selectAll(".voteMapSelBtn-rect-race").filter(function() {return this.getAttribute("buttonVal") != voteMapRace;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", false)
		    		.classed("voteMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".voteMapSelBtn-text-race").filter(function() {return this.getAttribute("buttonVal") != voteMapRace;})
		    		.classed("voteMapSelBtn-text-press", false)
		    		.classed("voteMapSelBtn-text-noPress", true);

		    	//change classes for demo var buttons
		    	d3.selectAll(".demoMapSelBtn-rect-vars")
		    		.classed("selBtn-rect-hover", false)
		    		.classed("demoMapSelBtn-rect-press", false)
		    		.classed("demoMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".demoMapSelBtn-text-vars")
		    		.classed("demoMapSelBtn-text-press", false)
		    		.classed("demoMapSelBtn-text-noPress", true);

		    	//change classes for demo change buttons
		    	d3.selectAll(".demoMapSelBtn-rect-change")
	    			.classed("selBtn-rect-hover", false)
		    		.classed("demoMapSelBtn-rect-press", false)
		    		.classed("demoMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".demoMapSelBtn-text-change")
		    		.classed("demoMapSelBtn-text-press", false)
		    		.classed("demoMapSelBtn-text-noPress", true);
				
				// voteMapTitle
	   //      		.text(getVoteMapTitle(voteMapDate, voteMapRace));

				// voteLegendBox.selectAll("*")
				// 	.remove();

				// demoLegendBox.selectAll("*")
				// 	.remove();

				// var voteLegend = voteLegendBox.append("g")
				// 	.attr("class", "vote-legend")
				// 	.each(makeVoteLegend);

				// var demoLegend = demoLegendBox.append("g")
				// 	.attr("class", "demo-legend")
				// 	.each(makeVoteLegend);


				updateMap();
				// updateDemoBars();
		    }



		    function handleDemoButtonClick(d) {
		    //updates global variable to newly chosen var via mouse click
		    //reclasses buttons when one is clicked
		    //reclassing changes graphic attributes to show new button as "selected" and others as "unselected"
		    	// console.log(catSel)
		    	// console.log(voteMapDate)
		    	// console.log(voteMapRace)
		    	// console.log(demoVar)
		    	// console.log(demoChange)
		    	catSel = "DEMO"

		    	if (d == "POPULATION DENSITY" || d == "PERCENT NON-WHITE" || d == "UNEMPLOYMENT RATE" || d == "EDUCATION" || d == "INCOME") {
		    		demoVar = d;
		    	}

		    	if (d == "CHANGE 2010-2015") {
		    		if (demoChange == "NO CHANGE") { 
						var demoChangeNew = "CHANGE";
					}
					if (demoChange == "CHANGE") {
						var demoChangeNew = "NO CHANGE";
					}
					demoChange = demoChangeNew;
		    	}
		    	
		    	//change classes for selected demo var button
		    	d3.selectAll(".demoMapSelBtn-rect-vars").filter(function() {return this.getAttribute("buttonVal") == demoVar;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("demoMapSelBtn-rect-press", true)
		    		.classed("demoMapSelBtn-rect-noPress", false);

		    	d3.selectAll(".demoMapSelBtn-text-vars").filter(function() {return this.getAttribute("buttonVal") == demoVar;})
		    		.classed("demoMapSelBtn-text-press", true)
		    		.classed("demoMapSelBtn-text-noPress", false);

		    	//change classes for other demo var buttons
		    	d3.selectAll(".demoMapSelBtn-rect-vars").filter(function() {return this.getAttribute("buttonVal") != demoVar;})
		    		.classed("selBtn-rect-hover", false)
		    		.classed("demoMapSelBtn-rect-press", false)
		    		.classed("demoMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".demoMapSelBtn-text-vars").filter(function() {return this.getAttribute("buttonVal") != demoVar;})
		    		.classed("demoMapSelBtn-text-press", false)
		    		.classed("demoMapSelBtn-text-noPress", true);

		    	//change classes for demo change button
		    	if (demoChange == "CHANGE") {
			    	d3.selectAll(".demoMapSelBtn-rect-change")
			    		.classed("selBtn-rect-hover", false)
			    		.classed("demoMapSelBtn-rect-press", true)
			    		.classed("demoMapSelBtn-rect-noPress", false);

			    	d3.selectAll(".demoMapSelBtn-text-change")
			    		.classed("demoMapSelBtn-text-press", true)
			    		.classed("demoMapSelBtn-text-noPress", false);
		    	}
		    	if (demoChange == "NO CHANGE") {
		    		d3.selectAll(".demoMapSelBtn-rect-change")
		    			.classed("selBtn-rect-hover", false)
			    		.classed("demoMapSelBtn-rect-press", false)
			    		.classed("demoMapSelBtn-rect-noPress", true);

			    	d3.selectAll(".demoMapSelBtn-text-change")
			    		.classed("demoMapSelBtn-text-press", false)
			    		.classed("demoMapSelBtn-text-noPress", true);
		    	}

		    	//change classes for vote date buttons
		    	d3.selectAll(".voteMapSelBtn-rect-date")
		    		.classed("voteMapSelBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", false)
		    		.classed("voteMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".voteMapSelBtn-text-date")
		    		.classed("voteMapSelBtn-text-press", false)
		    		.classed("voteMapSelBtn-text-noPress", true);

		    	//change classes for vote race buttons
		    	d3.selectAll(".voteMapSelBtn-rect-race")
		    		.classed("selBtn-rect-hover", false)
		    		.classed("voteMapSelBtn-rect-press", false)
		    		.classed("voteMapSelBtn-rect-noPress", true);

		    	d3.selectAll(".voteMapSelBtn-text-race")
		    		.classed("voteMapSelBtn-text-press", false)
		    		.classed("voteMapSelBtn-text-noPress", true);

				
				
				// demoBarsTitle
	   //      		.text(getDemoBarsTitle(demoVar, demoChange));

				updateMap();
				// updateDemoBars();
		    }


		    function wrap(text, width) {

	    		text.each(function() {	
	    		var text = d3.select(this),
            		words = text.text().split(" ").reverse(),
            		word,
            		width = demoButtonWidth-6,
            		line = [],
            		lines = 1,
            		lineNumber = 0,
            		lineHeight = 1.1,
            		x = this.getAttribute("x"),
            		y = this.getAttribute("y"),
            		dy = 0,
            		tspan = text.text(null)
            			.append("tspan")
                        .attr("x", x)
                        // .attr("y", y)
                        .attr("dy", dy + "em");


                    while (word = words.pop()) {
			            line.push(word);
			            tspan.text(line.join(" "));
			            if (tspan.node().getComputedTextLength() > width) {
			                line.pop();
			                var lineJoin = line.join(" ");			                
			                tspan.text(line.join(" "))
			                	.attr("y", y-(6));
			                line = [word];
			                tspan = text.append("tspan")
			                            .attr("x", x)
			                            .attr("y", y)
			                            .attr("dy", 6)
			                            // .attr("dy", ++lineNumber * lineHeight + dy + "em")
			                            .text(word);
			                // lines = lineNumber+1;
			            }
			            else {tspan.attr("y", y);}
			        }
				});
	    	}

	</script>	
</body>
</html>