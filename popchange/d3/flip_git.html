<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
  	<title>Flip the District</title> 
  	<style>
  	.bar {

	}
	/*.square {
		fill: "#cccccc")
		stroke: "#ffffff")
		stroke-width: .4)      
    	stroke-linecap: "butt")
	}*/
	/*.cdBoundariesOnDrag{
		stroke: "white";
		width: 400px;
		stroke-dasharray: "10";
	    stroke-linecap: "round";
	}*/

	.dragBar {
		fill: none;
	}
	.bar-overlay {
		fill: none;
	}
	.display-text-static {
		/*font: 36px "Helvetica Neue";*/
		font: 36px monospace;
	}

	.data-text-dem {
		/*font: bold 48px monospace;*/
		font: bold 48px "Helvetica Neue";
		fill: "#2437ff";
		stroke: "none";
		/*color: "#2437ff";*/
	}
	.data-text-rep {
		font: bold 48px "Helvetica Neue";
		fill: "#f4003d";
	}
	.votes-text{

	}

	/*line.line5050 {
		stroke: "gray";
		stroke-width: "4";
		stroke-linecap: "round";
		stroke-dasharray: "10";
	}*/

  	</style>
<!-- 	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
	<script src="https://d3js.org/d3-array.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo.v1.min.js"></script>
      <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js" charset="utf-8"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js" charset="utf-8"></script> -->
</head>
<body>
<div id ="flipTop"></div>
<div id ="flipDisplay"></div>
<div id ="flipBars"></div>


</body>
	<script>
	


	//Visualization "global" variables
	var rColor = "#f4003d",
		dColor = "#2437ff",
		oColor = "#f6b500",
		initialColor = "#cccccc";

	//<button class="button">load 2016 election data</button>

	//Read in Data and create visualization from that 
	d3.tsv("data/CD_Data_sm.tsv", function(data) {
		
		//nest data by CD	
		var cdData = d3.nest()
			.key(function(d) {return d.CD;}) 
			.entries(data);


	//
	//
	//Create global data holder.
	//Initialize to zero, fill from within makeBar()
	//////////////////////////////////////////////
		var voteDataHolder = [];
		
		for (i in cdData.length) {
			voteDataHolder.push(0);
		};

		console.log(voteDataHolder);


	//		
	//
	//Create bars for each Congressional District
	//this needs to be done first so that data values can then be read from bars
	/////////////////////////////////////////////

		var	numBars = cdData.length,
			w_bar = 25,
			h_bar = 200,
			barMargin = {top: 0, right: 11, bottom: 0, left: 11},
			boxMargin = {top: 30, right: 30, bottom: 0, left: 30};

		var barsBoxWidth = ((numBars*(barMargin.left+w_bar+barMargin.right))+(boxMargin.left+boxMargin.right)),
			barsBoxHeight = h_bar;

		//Create container to hold bars graphic
		var barsContainer = d3.select("#flipBars").append("svg")
			.attr("width", barsBoxWidth)
			.attr("height", barsBoxHeight);


		//Create dashed line to represent 50% of the votes	
		var lineLength = barsBoxWidth;

		var line = barsContainer.append("line")
			.attr("class", "line5050")
			.attr("x1", 0)
			.attr("x2", lineLength)
			.attr("y1", 100)
			.attr("y2", h_bar/2)
			.style("stroke", "#909090")
			.style("stroke-width", "2px")
			.style("stroke-dasharray", ("2,2"))
			.style("stroke-linecap", "butt");

		//Add an SVG holder for each bar/congressional district, with the desired dimensions and margin.
		//Append a "svg: g" to each SVG that moves bar into the center of the SVG mentioned above, creating space between bars
		var svg = barsContainer.selectAll("svg")
			.data(cdData)
		  .enter()
			.append("svg") //svg container for one bar element
			.attr("width", w_bar+barMargin.left+barMargin.right)
			.attr("height", h_bar+barMargin.top+barMargin.bottom)
			.attr("x", function (d, i) {
				return (boxMargin.left+(i*(w_bar+barMargin.right+barMargin.left)));
			})
		  .append("g") //g for bar itself, placed in svg container
	    	.attr("transform", "translate(" + barMargin.left + "," + barMargin.top + ")");

    	
	    //Append placeholder "svg:g" for each bar that rectangles will be appended to
	    var svgbar = svg.append("g")
			.attr("width", w_bar)
			.attr("height", h_bar)
			.each(makeBar);
		
		//
		//
		//Makes one bar//////////////////////////
		function makeBar(CD) {	
			
			//Specify drag functionality
			//This must be done within makeBar as drag functionality is bar/CD specific

			//drag helper variables and functions
			var dragVirginity = 0;
				startParty = 0;
								
			//translates mouse x,y to a number of votes
			function clickToVotes(a, b) {

				var barToVotes = d3.scaleLinear()
					.domain([0, (Math.sqrt(Math.pow(h_bar, 2)+Math.pow(w_bar, 2)))])
					.range([0, cdTotalVotes])
					.clamp(true);
				
				var hyp = Math.sqrt(Math.pow(a, 2)+Math.pow(b, 2));
				return barToVotes(hyp);
			}

			//drag functions

			function initiateDrag(d) {

				//Get existing vote values on drag start/start-click
				//If this is the first drag instance, use values from read-in data file
				//Else use values that were the result of the last drag

				if (dragVirginity == 0) {
					dStartVotes = +CD.values[0].DEM_USC;
					rStartVotes = +CD.values[0].REP_USC;
					oStartVotes = +CD.values[0].OTHERS_USC;
				}
				else {
					dStartVotes = voteDataHolder[CD.key-1]["DEM"];
					rStartVotes = voteDataHolder[CD.key-1]["REP"];
					oStartVotes = voteDataHolder[CD.key-1]["OTH"];
					console.log(voteDataHolder);
				}

				var x = Math.max(0, Math.min(w_bar, d3.mouse(this)[0])),
     				y = Math.max(0, Math.min(h_bar, d3.mouse(this)[1]));

				//convert mouse position to vote number
				startVotes = clickToVotes(x, y);
				
				//determine what color/party of the bar "was clicked on"
				var getParty = function() {
					//handle cases when CD is all one party	
					//if CD is 100% one party, startParty is the other party
					//allows users to introduce other party into originally monopolized district
					if (rStartVotes == cdTotalVotes) {return "D"}
					if (dStartVotes == cdTotalVotes) {return "R"}

					//else get on click
					else if (startVotes <= rStartVotes) {return "R";}
					else if (startVotes > rStartVotes && startVotes <= (rStartVotes+oStartVotes)) {return "O";}
					else if (startVotes > (rStartVotes+oStartVotes)) {return "D";}
				};

				startParty = getParty(startVotes);
				dragVirginity += 1;
			
			//end initiateDrag function ->
			}

			function dragChange(d) {
			// use this to style real-time changes, i.e. colors of squares changing
			// also display of votes
			
				//constrain displacement to dimensions of bar
				var x = Math.max(0, Math.min(w_bar, d3.mouse(this)[0])),
     				y = Math.max(0, Math.min(h_bar, d3.mouse(this)[1]));

     			//covert mouse position to vote number
				dragVotes = clickToVotes(x, y);

				//get new number of votes based on mouse position/drag 
				//and color/party that was first clicked on
				function getVotes() {
					if (startParty == "D") {
						if (dragVotes >= (cdTotalVotes-(dStartVotes+oStartVotes)) && dragVotes >= (cdTotalVotes-dStartVotes)) {
							dVotesDrag = cdTotalVotes-dragVotes;
							rVotesDrag = rStartVotes;
							oVotesDrag = cdTotalVotes-dVotesDrag-rVotesDrag;
							}
						else if (dragVotes >= (cdTotalVotes-(dStartVotes+oStartVotes)) && dragVotes < (cdTotalVotes-dStartVotes)) {
							dVotesDrag = cdTotalVotes-dragVotes;
							rVotesDrag = rStartVotes;
							oVotesDrag = cdTotalVotes-dVotesDrag-rVotesDrag;							
						}	

						else if (dragVotes < (cdTotalVotes-(dStartVotes+oStartVotes))) {
							dVotesDrag = cdTotalVotes-dragVotes;
							rVotesDrag = dragVotes;
							oVotesDrag = 0;
						}
					}
					if (startParty == "R") {
						if (dragVotes < (cdTotalVotes-(dStartVotes+oStartVotes))) {
							dVotesDrag = dStartVotes;
							rVotesDrag = dragVotes;
							oVotesDrag = cdTotalVotes-dVotesDrag-rVotesDrag;
						}
						else if (dragVotes >= (cdTotalVotes-(dStartVotes+oStartVotes)) && dragVotes < (cdTotalVotes-dStartVotes)) {
							dVotesDrag = dStartVotes;
							rVotesDrag = dragVotes;
							oVotesDrag = cdTotalVotes-dVotesDrag-rVotesDrag;;
						}
						else if (dragVotes >= (cdTotalVotes-(dStartVotes+oStartVotes)) && dragVotes >= (cdTotalVotes-dStartVotes)){
							dVotesDrag = cdTotalVotes-dragVotes;
							rVotesDrag = dragVotes;
							oVotesDrag = 0
						}
					}
					if (startParty == "O") {
						if (dragVotes < rStartVotes) {
							dVotesDrag = dStartVotes;
							rVotesDrag = dragVotes;
							oVotesDrag = cdTotalVotes-dVotesDrag-rVotesDrag;
						}
						else if (dragVotes >= rStartVotes && dragVotes < dStartVotes) {
							dVotesDrag = dStartVotes;
							rVotesDrag = rStartVotes;
							oVotesDrag = dragVotes-rStartVotes;
						}
						else if (dragVotes >= dStartVotes) {
							dVotesDrag = cdTotalVotes-dragVotes;
							rVotesDrag = rStartVotes;
							oVotesDrag = dragVotes-rStartVotes;
						}
					}
				}

				getVotes();

				dragVotesTot = (dVotesDrag+rVotesDrag+oVotesDrag);
				dPercent = (dVotesDrag/dragVotesTot);
				rPercent = (rVotesDrag/dragVotesTot);
				oPercent = (oVotesDrag/dragVotesTot);


				console.log("dVotesDrag - inside");
				console.log(dVotesDrag);

				var cdDragVoteData = {};
				
				cdDragVoteData["CD"] = +CD.key;
				cdDragVoteData["DEM"] = +dVotesDrag
				cdDragVoteData["REP"] = +rVotesDrag;
				cdDragVoteData["OTH"] = +oVotesDrag;
			
				voteDataHolder[CD.key-1] = cdDragVoteData;

				//
				//
				/////////Update bar colors
				var perDBar = (dVotesDrag/cdTotalVotes),
					perRBar = (rVotesDrag/cdTotalVotes),
					perOBar = (oVotesDrag/cdTotalVotes),
					cutDBar = perDBar*barRows*barCols,
					cutRBar = (perDBar+perOBar)*barRows*barCols;

				
				d3.selectAll(".barSquare").filter(function(){return this.getAttribute("CD") == CD.key})
					.attr("squareColor", function() {
					if (this.getAttribute('cellnum') <= cutDBar) {
					    return dColor;
					}
					if (this.getAttribute('cellnum') > cutDBar && (this.getAttribute('cellnum') <= cutRBar)) {
						return oColor;
					}
					if (this.getAttribute('cellnum') >= cutRBar) {
					    return rColor;
					}
					else {return rColor;}
					}
					)
					.transition()
			     		.duration(60)     	
			     		.style("fill", function() {
							return this.getAttribute('squareColor')
						});

			    //
			    //
			    /////////Update grid colors
			    var dSum = 0;
				for (var key in voteDataHolder) {
					dSum += voteDataHolder[key]["DEM"];
				};

				var rSum = 0;
				for (var key in voteDataHolder) {
					rSum += voteDataHolder[key]["REP"];
				};

				var oSum = 0;
				for (var key in voteDataHolder) {
					oSum += voteDataHolder[key]["OTH"];
				};


				var paSum = (dSum+rSum+oSum),
					perDGrid = (dSum/paSum),
					perRGrid = (rSum/paSum),
					perOGrid = (oSum/paSum),
					cutDGrid = perDGrid*gridRows*gridCols,
					cutOtherGrid = ((dSum+oSum)/paSum)*gridRows*gridCols;

				d3.selectAll(".gridSquare")
					.attr("squareColor", function() {
						if (this.getAttribute('cellnum') <= cutDGrid) {
					    return dColor;
						}
						if (this.getAttribute('cellnum') > cutDGrid && (this.getAttribute('cellnum') <= cutOtherGrid)) {
							return oColor;
						}
						else {return rColor;}
					})
					.transition()
				     	.duration(100)    	
				     	.style("fill", function() {
								return this.getAttribute('squareColor')
							});

				//
			    //
			    /////////Update map
			    d3.selectAll(".cdBoundaries").filter(function(){return this.getAttribute("CD") == CD.key})
			    	// .attr("class", "cdBoundariesOnDrag")
			    	// .raise()
			    	.attr("winner", function() {
		      			if ((dVotesDrag > rVotesDrag) && (dVotesDrag > oVotesDrag)) {
		      				return "DEM";
		      			}
		      			if ((rVotesDrag > dVotesDrag) && (rVotesDrag > oVotesDrag)) {
		      				return "REP";
		      			}
		      			if ((oVotesDrag > dVotesDrag) && (oVotesDrag > rVotesDrag)) {
		      				return "OTH";
		      			}
			      	})
			      	.transition()
			      		.duration(120)   	
				     	.style("fill", function(d) {
			      			if (this.getAttribute("winner") == "DEM") {
			      				return dColor;
			      			}
			      			if (this.getAttribute("winner") == "REP") {
			      				return rColor;
			      			}
			      			if (this.getAttribute("winner") == "OTH") {
			      				return oColor;
							}})
						;

				
				
				//
			    //
			    /////////Update display

			    var dSum = 0;
				var rSum = 0;
				var oSum = 0;
				for (var key in voteDataHolder) {
					dSum += voteDataHolder[key]["DEM"];
					rSum += voteDataHolder[key]["REP"];
					oSum += voteDataHolder[key]["OTH"];
				};
				
				var dDistrictSum = 0
				var rDistrictSum = 0
				for (var key in voteDataHolder) {
					if (voteDataHolder[key]["DEM"] >= voteDataHolder[key]["REP"] && voteDataHolder[key]["DEM"] >= voteDataHolder[key]["OTH"]) {
						dDistrictSum += 1;
					}
					if (voteDataHolder[key]["REP"] >= voteDataHolder[key]["DEM"] && voteDataHolder[key]["REP"] >= voteDataHolder[key]["OTH"]) {
						rDistrictSum += 1;
					}
				};	
				
				var format = d3.format(",d");

				d3.selectAll(".data-text-dem").filter(".votes-text")
					.text(format(dSum));

				d3.selectAll(".data-text-rep").filter(".votes-text")
					.text(format(rSum));

				d3.selectAll(".data-text-dem").filter(".districts-text")
					.text(format(dDistrictSum));

				d3.selectAll(".data-text-rep").filter(".districts-text")
					.text(format(rDistrictSum));

			//end dragChange function ->
			}

			function dragEnd(d) {

				d3.selectAll(".cdBoundaries").filter(function(){return this.getAttribute("CD") == CD.key})
					.classed("cdBoundariesOnDrag", false);
					// .transition()
					// 	.duration(30)
					// 	.style("stroke", function(d) { 
			  //     			return this.getAttribute("fill");
			  //     		})


			//end dragEnd function ->
			}

			//END OF DRAG FUNCTIONAALITY
			
			//sets dimension of cell in bar
			var sq = 5;

			var barRows = h_bar/sq,
				barCols = w_bar/sq,
				numSquares = barRows*barCols;

			// get values from initial data
			var cdVoteData = {};
			
			cdVoteData["CD"] = +CD.key;
			cdVoteData["DEM"] = +CD.values[0].DEM_USC;
			cdVoteData["REP"] = +CD.values[0].REP_USC;
			cdVoteData["OTH"] = +CD.values[0].OTHERS_USC;
			

			voteDataHolder[CD.key-1] = cdVoteData;


			var dVotes = +voteDataHolder[CD.key-1]["DEM"],
				rVotes = +voteDataHolder[CD.key-1]["REP"],
				oVotes = +voteDataHolder[CD.key-1]["OTH"],	
				cdTotalVotes = (dVotes+rVotes+oVotes),
				perD = (dVotes/cdTotalVotes),
				perR = (rVotes/cdTotalVotes),
				perO = (oVotes/cdTotalVotes),
				cutD = perD*barRows*barCols,
				cutOther = ((dVotes+oVotes)/cdTotalVotes)*barRows*barCols;


			var delayTime = 8,
				delayTimeOther = delayTime*2
				pauseTime = 500;


			var svg = d3.select(this)
				.attr("class", "bar")
				.attr("CD", CD.key)
				.style("fill", "none");				

			
			//make transparent rectangle to pick up drag
			svg.append("rect")
			    .attr("class", "dragBar")
			    .attr("CD", CD.key)
			    .style("pointer-events", "all")
			    .attr("width", w_bar)
			    .attr("height", h_bar)
			    // .call(drag());
			    .call(d3.drag()
			    	.on("start", initiateDrag)
					.on("drag", dragChange))
			    	.on("end", dragEnd);
		    
			
			//makes squares as "rect" elements
			var squares = svg.selectAll(".barSquare")
				.data(d3.range(numSquares))
		  	  .enter()
				.append('rect')
				.attr("class", "barSquare")
				.attr("CD", CD.key)
				.attr("width", sq)
				.attr("height", sq)
				.attr("cellnum", function (i) {return ((numSquares)-i);})
				.attr("x", function(i) {return (sq*(i%barCols));})
				.attr("y", function(i) {return (sq*Math.floor((i/barCols)));})
				.style("fill",initialColor)
				.style("stroke", "ffffff")
				.style("stroke-width", .4)      
    			.style("stroke-linecap", "butt")
    			.style("pointer-events", "none")		
				.attr("squareColor", function() {
					if (this.getAttribute('cellnum') <= cutD) {
					    return dColor;
					}
					if (this.getAttribute('cellnum') > cutD && (this.getAttribute('cellnum') <= cutOther)) {
						return oColor;
					}
					else {return rColor;}
				})
				.transition()
			     	.delay(function() {
						if (this.getAttribute('squareColor') == dColor) {
		   					return (pauseTime+this.getAttribute("cellnum")*delayTime);
		     			}
		     			if (this.getAttribute('squareColor') == oColor) {
		   					return (pauseTime+((this.getAttribute("cellnum")*delayTimeOther)+(cutOther*delayTime)));
		     			}
		     			if (this.getAttribute('squareColor') == rColor) {
		     	
		     				return (pauseTime+((cutD*delayTime)+((numSquares)-this.getAttribute("cellnum")+1)*delayTime));
		     				}
						})     	
			     	.style("fill", function() {
							return this.getAttribute('squareColor')
						});
			    //end makeBar function ->
			    }


	//
	//
	//Create top container (to hold map and vote grid)
	/////////////////////////////////////////////
		var topBoxWidth = 900,
			topBoxHeight = 300;

		var topContainer = d3.select("#flipTop").append("svg")
			.attr("width", topBoxWidth)
			.attr("height", topBoxHeight);

	//
	//
	//Create small map of Pennsylvania in top container
	/////////////////////////////////////////////
		var mapBoxWidth = 475,
			mapBoxHeight = 300;

		//Create container to hold map graphic
		var mapContainer = topContainer.append("svg")
			.attr("width", mapBoxWidth)
			.attr("height", mapBoxHeight)
			.attr("x", 50);


		d3.json("jsons/PA_CongDist_2015.json", function(error, pa) {
		  if (error) return console.error(error);
		  
		
			var projection = d3.geoAlbers()
		    .scale(6000)
		    .rotate( [77.1945,0] )
    		.center( [0, 41.2033] )
		    .translate([mapBoxWidth / 2, mapBoxHeight / 2]);

		    var path = d3.geoPath()
		    .projection(projection);


			mapContainer.append("g")
				.attr("class", "map")
				.selectAll("path")
		    .data(topojson.feature(pa, pa.objects.PA_CongDist_2015).features) 
		      	.enter().append("path")
		      	.attr("class", "cdBoundaries")
		      	.attr("d", path)
		      	.attr("CD", function(d) {return +d.properties.CD114FP})
		      	.attr("winner", function(d) {
		      		var cd = this.getAttribute("CD");
		      		var dVotes = voteDataHolder[cd-1]["DEM"];
		      		var rVotes = voteDataHolder[cd-1]["REP"];
		      		var oVotes = voteDataHolder[cd-1]["OTH"];
		      		if ((dVotes > rVotes) && (dVotes > oVotes)) {
		      			return "DEM";
		      		}
		      		if ((rVotes > dVotes) && (rVotes > oVotes)) {
		      			return "REP";
		      		}
		      		if ((oVotes > dVotes) && (oVotes > rVotes)) {
		      			return "OTH";
		      		}
		      	})
		      	.style("fill", initialColor)
		      	// .style("stroke", "initialColor")
		      	// .style("stroke", "none")
		      	.transition()
		      		.delay(function(d) {
		      			var cdNum = +d.properties.CD114FP;
		      			return (300+(cdNum*70));
		      		})
		      		.duration(420)   	
			     	.style("fill", function(d) {
						var cdNum = +d.properties.CD114FP;
		      			if (this.getAttribute("winner") == "DEM") {
		      				return dColor;
		      			}
		      			if (this.getAttribute("winner") == "REP") {
		      				return rColor;
		      			}
		      			if (this.getAttribute("winner") == "REP") {
		      				return oColor;
						}
			    	// })
			    	// .style("stroke", function(d) { 
		      // 			return this.getAttribute("fill");
		      		});
		      		// .style("stroke", "white")
		      		// .style("width", "300px")
		      		// .style("stroke-dasharray", "2")
		      		// .style("stroke-linecap", "round");
		      		
		//end d3.json function call ->
		});
	//end of small map 


	//
	//
	//Create vote grid for Pennsylvania at large in top container
	/////////////////////////////////////////////
		var voteGridWidth = 250,
			voteGridHeight = 250,
			sq = 5,
			gridRows = voteGridHeight/sq,
			gridCols = voteGridWidth/sq,
			numSquares = gridRows*gridCols;

		//Create container to hold vote grid graphic
		var voteGridContainer = topContainer.append("svg")
			.attr("width", voteGridWidth)
			.attr("height", voteGridHeight)
			.attr("x", 600)
			.attr("y", 50)
			.append("g");
			
			

		var grid = voteGridContainer.each(makeVoteGrid);
		


		function makeVoteGrid () {

			//var svg = voteGridContainer.append("svg");
			var svg = d3.select(this);
			
			//get vote data from voteDataHolder
			var dSum = 0;
			for (var key in voteDataHolder) {
				dSum += voteDataHolder[key]["DEM"];
			};

			var rSum = 0;
			for (var key in voteDataHolder) {
				rSum += voteDataHolder[key]["REP"];
			};

			var oSum = 0;
			for (var key in voteDataHolder) {
				oSum += voteDataHolder[key]["OTH"];
			};

			var paSum = (dSum + rSum + oSum),
				perDGrid = (dSum/paSum),
				perRGrid = (rSum/paSum),
				perOGrid = (oSum/paSum),
				cutDGrid = perDGrid*gridRows*gridCols,
				cutOtherGrid = ((dSum+oSum)/paSum)*gridRows*gridCols;

			var delayTime = 2.8,
				pauseTime = 0;

			//makes squares as "rect" elements
			var squares = svg.selectAll(".gridSquare")
				.data(d3.range(numSquares))
		  	  .enter()
				.append('rect')
				.attr("class", "gridSquare")
				.attr("width", sq)
				.attr("height", sq)
				.attr("cellnum", function (i) {return ((numSquares)-i);})
				.attr("x", function(i) {return (sq*(i%gridCols));})
				.attr("y", function(i) {return (sq*Math.floor((i/gridCols)));})
				.style("fill",initialColor)
				.style("stroke", "ffffff")
				.style("stroke-width", .4)      
    			.style("stroke-linecap", "butt")		
				.attr("squareColor", function() {
					if (this.getAttribute('cellnum') <= cutDGrid) {
					    return dColor;
					}
					if (this.getAttribute('cellnum') > cutDGrid && (this.getAttribute('cellnum') <= cutOtherGrid)) {
						return oColor;
					}
					else {return rColor;}
				})
				.transition()
			     	.delay(function() {
						if (this.getAttribute('squareColor') == dColor) {
		   					return (pauseTime+this.getAttribute("cellnum")*delayTime);
		     			}
		     			if (this.getAttribute('squareColor') == oColor) {
		     				if (cutOtherGrid < (numSquares)/2) {
		   						return (pauseTime+(((numSquares)-(this.getAttribute("cellnum"))+1)*delayTime)+(100*delayTime));
		     				}
		     				else {
		   						return (pauseTime+((this.getAttribute("cellnum"))+1)*delayTime)+(100*delayTime);
		     				}
		     			}
		     			if (this.getAttribute('squareColor') == rColor) {
		     				return (pauseTime+((numSquares)-this.getAttribute("cellnum")+1)*delayTime);
		     				}
						})     	
			     	.style("fill", function() {
							return this.getAttribute('squareColor')
						});
		//end makeVoteGrid function ->
		}
	//end of vote grid
	//end of top container 



	//
	//
	//Create display to show numbers
	/////////////////////////////////////////////
		var displayBoxWidth = 900,
			displayBoxHeight = 150;

		//Create container to hold vote grid graphic
		var displayContainer = d3.select("#flipDisplay").append("svg")
			.attr("width", displayBoxWidth)
			.attr("height", displayBoxHeight)
			.append("g");

		//Get data variables	
		var dSum = 0;
		var rSum = 0;
		var oSum = 0;
		for (var key in voteDataHolder) {
			dSum += voteDataHolder[key]["DEM"];
			rSum += voteDataHolder[key]["REP"];
			oSum += voteDataHolder[key]["OTH"];
		};

		var dDistrictSum = 0
		var rDistrictSum = 0
		for (var key in voteDataHolder) {
			if (voteDataHolder[key]["DEM"] >= voteDataHolder[key]["REP"] && voteDataHolder[key]["DEM"] >= voteDataHolder[key]["OTH"]) {
				dDistrictSum += 1;
			}
			if (voteDataHolder[key]["REP"] >= voteDataHolder[key]["DEM"] && voteDataHolder[key]["REP"] >= voteDataHolder[key]["OTH"]) {
				rDistrictSum += 1;
			}
		};		
	
		//Make display boxes for text elements

		//For static text
		var votesFixedDisplay = displayContainer.append("text")
			.attr("class", "display-text-static")
			.attr("x", displayBoxWidth/2)
			.attr("y", (displayBoxHeight/2)-20)
			.style("text-anchor", "middle")
			.text("votes");

		var districtsFixedDisplay = displayContainer.append("text")
			.attr("class", "display-text-static")
			.attr("x", displayBoxWidth/2)
			.attr("y", (displayBoxHeight/2)+40)
			.style("text-anchor", "middle")
			.text("districts");

		
		//For dynamic text

		//Convert floating point numbers to something normal
		var format = d3.format(",d");

		//Dem Votes
		var demVotesDisplay = displayContainer.append("g")

		var demVotesNum = demVotesDisplay.append("text")
			.attr("class", "data-text-dem votes-text")
			.attr("id", "dVotesDisplay")
			.attr("width", 300)
			.attr("x", displayBoxWidth/4)
			.attr("y", (displayBoxHeight/2)-15)
			.style("text-anchor", "middle")
			.style("fill", dColor)
			.style("stroke", "none")
			.text("0")

		demVotesDisplay.select("text")
			.transition()
				.ease(d3.easeQuadOut) 
				.duration(2500)
				.tween("text", function() {
					var that = d3.select(this);
					var	i = interpolateNumber(that.text(), dSum);
						return function(t) { 
							that.text(format(i(t)));
						};
				});	

		//Rep Votes
		var repVotesDisplay = displayContainer.append("g")

		var repVotesNum = repVotesDisplay.append("text")
			.attr("class", "data-text-rep votes-text")
			.attr("id", "rVotesDisplay")
			.attr("width", 300)
			.attr("x", displayBoxWidth*(3/4))
			.attr("y", (displayBoxHeight/2)-15)
			.style("text-anchor", "middle")
			.style("fill", rColor)
			.style("stroke", "none")
			.text("0")
			

		repVotesDisplay.select("text")	
			.transition()
				.ease(d3.easeQuadOut) 
				.duration(2500)
				.tween("text", function() {
					var that = d3.select(this);
					var	i = interpolateNumber(that.text(), rSum);
						return function(t) { 
							that.text(format(i(t)));
						};
				});

		//Dem Districts
		var demDistrictsDisplay = displayContainer.append("g")

		var demDistrictsNum = demDistrictsDisplay.append("text")
			.attr("class", "data-text-dem districts-text")
			.attr("id", "dDistrictsDisplay")
			.attr("x", displayBoxWidth*(1/4))
			.attr("y", (displayBoxHeight/2)+40)
			.style("text-anchor", "middle")
			.style("fill", dColor)
			.text("");

		demDistrictsDisplay.select("text")	
			.transition()
				//.ease("poly-out")
				.duration(2500)
				.tween("text", function() {
					var that = d3.select(this);
					var	i = interpolateNumber(that.text(), dDistrictSum);
					return function(t) { 
						that.text(format(i(t)));
						};
				});

		
		//Rep districts
		var repDistrictsDisplay = displayContainer.append("g")

		var repDistrictsNum = repDistrictsDisplay.append("text")
			.attr("class", "data-text-rep districts-text")
			.attr("id", "rDistrictsDisplay")
			.attr("x", displayBoxWidth*(3/4))
			.attr("y", (displayBoxHeight/2)+40)
			.style("text-anchor", "middle")
			.style("fill", rColor)
			.text("");


		repDistrictsDisplay.select("text")	
			.transition()
				//.ease("poly-out")
				.duration(2500)
				.tween("text", function() {
					var that = d3.select(this);
					var	i = interpolateNumber(that.text(), rDistrictSum);
					return function(t) { 
						that.text(format(i(t)));
						};
				});

		function interpolateNumber(a, b) {
  			return function(t) {
    		return a + t * (b - a);
  			};
		}


	console.log(voteDataHolder);
	
	//end d3.tsv function call ->
	})	

	// 	.on("mouseover", tip.show)
	// 	.on("mouseout", tip.hide)



</script>
</body>
</html>

