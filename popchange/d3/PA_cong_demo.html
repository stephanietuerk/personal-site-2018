
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Congressional District Demographics</title>
	<style>
		.tracts {
			stroke: none;
			//stroke: #bebebe;
      		stroke-linejoin: round;
		}
		.hover {
			stroke: "#ffffff";
		}

	</style>
	  <script src="https://d3js.org/d3.v4.min.js"></script>
      <script src="https://d3js.org/d3-array.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo.v1.min.js"></script>
      <script src="https://d3js.org/d3-queue.v3.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js" charset="utf-8"></script>

</head>
<body>
	<h2>Congressional District 1</h2>
	<h2>Rate of Population Change, 2010 - 2015</h2>
	<div id="popchange"></div>
	<h2>Change in the number of Non-Whites, 2010 - 2015</h2>
	<div id="nonwhitechange"></div>
	<h2>Change in Unemployment, 2010 - 2015</h2>
	<div id="employchange"></div>
	<h2>Changes in education, 2010 - 2015</h2>
	<div id="educhange"></div>
	<h2>Changes in median income, 2010 - 2015</h2>
	<div id="meanchange"></div>
	<h2>Changes in mean income, 2010 - 2015</h2>
	<div id="medchange"></div>

	<!-- Page elements and content go here. -->
	<script>
		var repRed = "#e81d41";

		var demBlue = "#406fea";

		var width = 1200,
		    height = 650;

		var width_sm = 700,
			height_sm = 500;

		var projection = d3.geoAlbers()
		    .scale(10000)
		    .rotate( [77.1945,0] )
    		.center( [0, 41.2033] )
		    .translate([width / 2, height / 2]);

    	var path = d3.geoPath()
		    .projection(projection);

	    var svg1 = d3.select("#popchange")
			.append("svg")
		    .attr("width", width)
		    .attr("height", height);

		var svg2 = d3.select("#nonwhitechange")
			.append("svg")
		    .attr("width", width)
		    .attr("height", height);

		var svg3 = d3.select("#employchange")
			.append("svg")
			.attr("width", width_sm)
			.attr("height", height_sm);

		var svg4 = d3.select("#educhange")
			.append("svg")
			.attr("width", width_sm)
			.attr("height", height_sm);
			
		var svg5 = d3.select("#meanchange")
			.append("svg")
			.attr("width", width_sm)
			.attr("height", height_sm);

		var svg6 = d3.select("#medchange")
			.append("svg")
			.attr("width", width_sm)
			.attr("height", height_sm);	

		// var svg7 = d3.select("#grid")
		// 	.append("svg")
		// 	.attr("width", width_sm)
		// 	.attr("height", height_sm);



        var popcolor = d3.scaleThreshold()
        
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);
          // .domain([0, 1])
          // .range(['#f1eef6','#006d2c']);

        var nonwhitecolor = d3.scaleThreshold()
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);

        var employcolor = d3.scaleThreshold()
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);

        var educolor = d3.scaleThreshold()
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);
          
        var meancolor = d3.scaleThreshold()
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);

        var medcolor = d3.scaleThreshold()
          .domain([-0.101973328, -0.056577484, -0.032211804, -0.014479615, 0, 0.019022844, 0.041534347, 0.075392467, 0.128429125, 10])
          .range(['#00b7a6','#00ccba','#00e2cd','#00f9e2','#bffff4','#ffeef9','#ffd2f0','#ffb5e8','#ff96e1','#ff72db']);



		// Queue up datasets using d3 Queue

		d3.queue()
		    .defer(d3.json, "jsons/PA_CensusTracts_2010.json") 
		    .defer(d3.csv, "data/CT_demo_data.csv") 
		    .await(drawMaps); 

		


		}

		function drawMaps(error, cd, votes, pop) {
			if (error) throw error;
		  
		  	


		  	var popChangeByTract = {};
		  	pop.forEach(function(d) {
		  		popChangeByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});


		  	var nonwhiteChangeByTract = {};
		  	pop.forEach(function(d) {
		  		nonwhiteChangeByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});


		  	var employChangeByTract = {};
		  	pop.forEach(function(d) {
		  		employChangeByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});


		  	var eduChangeByTract = {};
		  	pop.forEach(function(d) {
		  		eduChangeByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});

		  	var meanByTract = {};
		  	pop.forEach(function(d) {
		  		meanByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});

		  	var medByTract = {};
		  	pop.forEach(function(d) {
		  		medByTract[d.GEO_ID] = +d.CT_demo_data;
		  	});





		  	svg1.append("g")
		    	.attr("class", "tracts")
		    .selectAll("path")
		    	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		    	.enter().append("path")
		    	.attr("d", path)
		    	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		//console.log(name);
		      		//console.log(popChangeByTract[name])
		      		return popcolor(popChangeByTract[name]); });


		  	svg2.append("g")
		      	.attr("class", "tracts")
		    .selectAll("path")
		     	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		      	.enter().append("path")
		      	.attr("d", path)
		      	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		// console.log(name);
		      		// console.log(stDevByTract[name])
		      		return nonwhitechange(nonwhiteChangeByTract[name]); });


		  	svg3.append("g")
		    	.attr("class", "tracts")
		    .selectAll("path")
		    	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		    	.enter().append("path")
		    	.attr("d", path)
		    	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		//console.log(name);
		      		//console.log(popChangeByTract[name])
		      		return employchange(employChangeByTract[name]); });


		  	svg4.append("g")
		      	.attr("class", "tracts")
		    .selectAll("path")
		     	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		      	.enter().append("path")
		      	.attr("d", path)
		      	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		// console.log(name);
		      		// console.log(stDevByTract[name])
		      		return educhange(eduChangeByTract[name]); });


		  	svg5.append("g")
		    	.attr("class", "tracts")
		    .selectAll("path")
		    	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		    	.enter().append("path")
		    	.attr("d", path)
		    	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		//console.log(name);
		      		//console.log(popChangeByTract[name])
		      		return meanchange(meanByTract[name]); });


		  	svg6.append("g")
		      	.attr("class", "tracts")
		    .selectAll("path")
		     	.data(topojson.feature(pa, pa.objects.PA_CensusTracts_2010).features) 
		      	.enter().append("path")
		      	.attr("d", path)
		      	.attr("fill", function(d) { 
		      		var name = d.properties.GEO_ID;
		      		// console.log(name);
		      		// console.log(stDevByTract[name])
		      		return medchange(medByTract[name]); });		      	

		};

		function drawGrid(error) { 
			if (error) throw error;
			
			var square = 5,
			  w = 400,
			  h = 400;

			//create the svg
			var svg = d3.select("#grid").append("svg")
			//var svg = d3.select('#grid').append('svg')
			  .attr({
			    width: w,
			    height: h
			  });

			// calculate number of rows and columns
			var squaresRow = _.round(w / square);
			var squaresColumn = _.round(h / square);

			var percentYes = 0.54;
			var percentNo = 0.46;

			var yesColor = "#e81d41";
			var noColor = "#406fea";

			// loop over number of columns
			_.times(squaresColumn, function(n) {

			  // create each set of rows
			  	var rows = svg.selectAll('rect' + ' .row-' + (n + 1))
		    	
		    	.data(d3.range(squaresRow))
		    	.enter().append('rect')
		    	.attr({
		      		class: function(d, i) {
		        	return 'square row-' + (n + 1) + ' ' + 'col-' + (i + 1);
		      		},
		      		id: function(d, i) {
		        	return 's-' + (n + 1) + (i + 1);
		      		},
				    width: square,
				    height: square,
				    x: function(d, i) {
				        return i * square;
				      },
				    y: n * square,
				    cellnum: function(d, i) {
				        return ((n*squaresRow) + (i));
				      },
				    fill: '#cccccc',
				    stroke: '#ffffff'
				})
				.transition()
		     		.delay(function(d) {
			     		//var x = this.getAttribute('x')
			     		var cell = this.getAttribute('cellnum')
			     		//var cellnum = ((y/square)*squaresColumn) + (x/square)
			     		if (cell < (percentYes * (squaresColumn * squaresRow))) {
			     			return (cell * 1);
			     		}
			     		if (cell >= (percentYes * (squaresColumn * squaresRow))) { return (((squaresRow*squaresColumn) - cell)*1);
						}
					})
			    	.style("fill", function(d, i) {
				      	var cell = this.getAttribute('cellnum')
				      	if (cell < (percentYes * (squaresColumn * squaresRow))) {
				      		return yesColor;
				      	} 
				      	else {
				      		return noColor;
						}
					})
		    	});
		}
	
	</script>	
</body>
</html>
